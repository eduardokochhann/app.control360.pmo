{% extends "base.html" %}

{% block title %}{{ titulo_pagina if titulo_pagina else 'Status Report' }}{% endblock %}

{% block extra_css %}
{{ super() }}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
<style>
    /* === CORES SOU.CLOUD === */
    :root {
        --sou-rosa: #FF2D5F;
        --sou-azul: #07304F;
        --sou-azul-claro: #4a90e2;
        --sou-cinza: #f8f9fc;
        --sou-cinza-escuro: #5a5c69;
    }

    /* === CONTROLE DE VISIBILIDADE === */
    .pdf-only {
        display: none;
    }
    
    .hours-private {
        display: block;
    }
    
    .hours-public {
        display: none;
    }
    
    /* Quando em modo p칰blico, inverte a visibilidade */
    .public-mode .hours-private {
        display: none !important;
    }
    
    .public-mode .hours-public {
        display: block !important;
    }
    
    /* For칞ar visibilidade padr칚o no modo privado */
    body:not(.public-mode) .hours-private {
        display: block !important;
    }
    
    body:not(.public-mode) .hours-public {
        display: none !important;
    }

    /* === CABE칂ALHO PROFISSIONAL === */
    .sou-header {
        background: linear-gradient(135deg, var(--sou-azul) 0%, var(--sou-azul-claro) 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 0.5rem;
        position: relative;
        overflow: hidden;
    }
    
    .sou-header::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 200px;
        height: 100%;
        background: linear-gradient(45deg, transparent 30%, rgba(255, 45, 95, 0.1) 100%);
    }
    
    .sou-header .container-fluid {
        position: relative;
        z-index: 2;
    }
    
    .sou-logo {
        max-height: 60px;
        filter: brightness(0) invert(1);
    }
    
    .report-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin: 0;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .report-subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        margin-top: 0.5rem;
    }

    /* === CARDS DE KPI PROFISSIONAIS === */
    .kpi-card-modern {
        border: none;
        border-radius: 1rem;
        overflow: hidden;
        transition: all 0.3s ease;
        background: white;
        box-shadow: 0 0.25rem 1rem rgba(0,0,0,0.1);
    }
    
    .kpi-card-modern:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 2rem rgba(0,0,0,0.15);
    }
    
    .kpi-card-modern .card-body {
        padding: 1.5rem;
        position: relative;
    }
    
    .kpi-icon-modern {
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 2.5rem;
        opacity: 0.1;
        color: var(--sou-azul);
    }
    
    .kpi-label {
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--sou-cinza-escuro);
        margin-bottom: 0.5rem;
        display: block;
    }
    
    .kpi-value {
        font-size: 2.2rem;
        font-weight: 700;
        color: var(--sou-azul);
        line-height: 1;
        margin-bottom: 0.25rem;
    }
    
    .kpi-subtitle {
        font-size: 0.8rem;
        color: var(--sou-cinza-escuro);
        opacity: 0.8;
    }
    
    /* Varia칞칫es de cores para KPIs */
    .kpi-status .kpi-icon-modern { color: var(--sou-rosa); }
    .kpi-progress .kpi-icon-modern { color: #28a745; }
    .kpi-schedule .kpi-icon-modern { color: #ffc107; }
    .kpi-effort .kpi-icon-modern { color: var(--sou-azul-claro); }

    /* === STATUS DOTS MELHORADOS === */
    .status-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .status-dot-modern {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        position: relative;
    }
    
    .status-dot-modern::after {
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.3); opacity: 0.5; }
        100% { transform: scale(1); opacity: 1; }
    }
    
    .status-no-prazo { background-color: #28a745; }
    .status-no-prazo::after { background-color: #28a745; }
    
    .status-atencao { background-color: #ffc107; }
    .status-atencao::after { background-color: #ffc107; }
    
    .status-critico { background-color: var(--sou-rosa); }
    .status-critico::after { background-color: var(--sou-rosa); }
    
    .status-concluido { background-color: var(--sou-azul); }
    .status-concluido::after { background-color: var(--sou-azul); }

    /* === CONTE칔DO RICO - EDITOR FORMATADO === */
    .rich-content {
        font-family: inherit;
        line-height: 1.6;
    }
    
    .rich-content h1, .rich-content h2, .rich-content h3 {
        color: var(--sou-azul);
        font-weight: 600;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
    }
    
    .rich-content h1 { font-size: 1.4rem; }
    .rich-content h2 { font-size: 1.2rem; }
    .rich-content h3 { font-size: 1.1rem; }
    
    .rich-content strong {
        color: var(--sou-azul);
        font-weight: 600;
    }
    
    .rich-content em {
        font-style: italic;
        color: var(--sou-cinza-escuro);
    }
    
    .rich-content ul, .rich-content ol {
        margin: 0.5rem 0;
        padding-left: 1.5rem;
    }
    
    .rich-content li {
        margin-bottom: 0.25rem;
    }
    
    .rich-content blockquote {
        border-left: 4px solid var(--sou-rosa);
        background: var(--sou-cinza);
        padding: 0.75rem 1rem;
        margin: 1rem 0;
        border-radius: 0 0.5rem 0.5rem 0;
        font-style: italic;
    }
    
    .rich-content table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
        border-radius: 0.5rem;
        overflow: hidden;
        border: 1px solid #dee2e6;
    }
    
    .rich-content table td, .rich-content table th {
        padding: 0.75rem;
        border: 1px solid #dee2e6;
        text-align: left;
    }
    
    .rich-content table th {
        background: var(--sou-azul);
        color: white;
        font-weight: 600;
    }
    
    .rich-content table tr:nth-child(even) {
        background: var(--sou-cinza);
    }
    
    .rich-content img {
        max-width: 100%;
        height: auto;
        border-radius: 0.5rem;
        margin: 0.5rem 0;
    }
    
    .rich-content a {
        color: var(--sou-rosa);
        text-decoration: none;
    }
    
    .rich-content a:hover {
        text-decoration: underline;
    }
    
    .rich-content code {
        background: var(--sou-cinza);
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
    }
    
    .rich-content pre {
        background: var(--sou-cinza);
        padding: 1rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin: 1rem 0;
    }
    
    /* === T칈TULO DO RISCO === */
    .risk-title {
        color: var(--sou-azul);
        font-weight: 600;
        font-size: 1rem;
        display: block;
        margin-bottom: 0.25rem;
    }

    /* === INFORMA칂칏ES DO PROJETO === */
    .project-info-modern {
        background: linear-gradient(135deg, #ffffff 0%, var(--sou-cinza) 100%);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(7, 48, 79, 0.1);
    }
    
    .project-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }
    
    .project-info-item {
        display: flex;
        flex-direction: column;
    }
    
    .project-info-label {
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        color: var(--sou-cinza-escuro);
        margin-bottom: 0.25rem;
        letter-spacing: 0.5px;
    }
    
    .project-info-value {
        font-size: 1rem;
        font-weight: 600;
        color: var(--sou-azul);
    }

    /* === SE칂칏ES DE CONTE칔DO === */
    .content-section {
        background: white;
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 0.125rem 0.5rem rgba(0,0,0,0.05);
        border: 1px solid rgba(7, 48, 79, 0.1);
    }
    
    .section-header-modern {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--sou-cinza);
    }
    
    .section-icon {
        background: linear-gradient(135deg, var(--sou-rosa) 0%, #ff4569 100%);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-size: 1.1rem;
    }
    
    .section-title-modern {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--sou-azul);
        margin: 0;
    }

    /* === TABELAS PROFISSIONAIS === */
    .table-modern {
        margin-bottom: 0;
    }
    
    .table-modern thead th {
        background: linear-gradient(135deg, var(--sou-azul) 0%, var(--sou-azul-claro) 100%);
        color: white;
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: none;
        padding: 1rem 0.75rem;
    }
    
    .table-modern tbody td {
        vertical-align: middle;
        padding: 0.75rem;
        border-bottom: 1px solid rgba(7, 48, 79, 0.1);
    }
    
    .table-modern tbody tr:hover {
        background-color: rgba(7, 48, 79, 0.02);
    }

    /* === BADGES MODERNOS === */
    .badge-modern {
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        font-weight: 500;
        font-size: 0.75rem;
    }
    
    .badge-success-modern { background-color: #28a745; }
    .badge-warning-modern { background-color: #ffc107; color: #000; }
    .badge-danger-modern { background-color: var(--sou-rosa); }
    .badge-primary-modern { background-color: var(--sou-azul); }
    .badge-info-modern { background-color: var(--sou-azul-claro); }

    /* === BOT칏ES PROFISSIONAIS === */
    .btn-sou-primary {
        background: linear-gradient(135deg, var(--sou-azul) 0%, var(--sou-azul-claro) 100%);
        border: none;
        color: white;
        font-weight: 600;
        border-radius: 0.5rem;
        padding: 0.5rem 1rem;
        transition: all 0.3s ease;
    }
    
    .btn-sou-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(7, 48, 79, 0.3);
    }
    
    .btn-sou-secondary {
        background: linear-gradient(135deg, var(--sou-rosa) 0%, #ff4569 100%);
        border: none;
        color: white;
        font-weight: 600;
        border-radius: 0.5rem;
        padding: 0.5rem 1rem;
        transition: all 0.3s ease;
    }
    
    .btn-sou-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(255, 45, 95, 0.3);
    }

    /* === TOGGLE PARA VISIBILIDADE DE HORAS === */
    .hours-visibility-toggle {
        position: fixed;
        top: 100px;
        left: 20px;
        z-index: 1000;
        background: white;
        border-radius: 0.5rem;
        padding: 1rem;
        box-shadow: 0 0.25rem 1rem rgba(0,0,0,0.15);
        border: 1px solid rgba(7, 48, 79, 0.1);
        transition: all 0.3s ease;
    }
    
    .toggle-hide-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background: none;
        border: none;
        color: var(--sou-cinza-escuro);
        font-size: 0.8rem;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s ease;
        opacity: 0.6;
    }
    
    .toggle-hide-btn:hover {
        background-color: rgba(255, 45, 95, 0.1);
        color: var(--sou-rosa);
        opacity: 1;
        transform: scale(1.1);
    }
    
    .hours-visibility-toggle.hidden {
        transform: translateX(-100%);
        opacity: 0;
        pointer-events: none;
    }
    
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }
    
    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 34px;
    }
    
    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
        background-color: var(--sou-azul);
    }
    
    input:checked + .toggle-slider:before {
        transform: translateX(26px);
    }

    /* === ESTILOS TIMELINE === */
    .timeline-section {
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid rgba(7, 48, 79, 0.1);
    }
    
    .timeline-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }
    
    .timeline-section .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        padding: 0.75rem;
        background: rgba(7, 48, 79, 0.02);
        border-radius: 0.5rem;
        border-left: 4px solid var(--sou-azul);
    }
    
    .timeline-section .section-header i {
        margin-right: 0.5rem;
        font-size: 1.1rem;
    }
    
    .timeline-section .section-header span {
        font-weight: 600;
        font-size: 1rem;
        color: var(--sou-azul);
    }

    /* === ESTILOS PARA PDF === */
    @media print {
        @page {
            size: A4 portrait;
            margin: 1cm;
        }
        
        .pdf-only {
            display: block !important;
        }
        
        .screen-only {
            display: none !important;
        }
        
        .hours-visibility-toggle {
            display: none !important;
        }
        
        .sou-header {
            background: var(--sou-azul) !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }
        
        .kpi-card-modern {
            page-break-inside: avoid;
            box-shadow: none;
            border: 1px solid #ddd;
        }
        
        .content-section {
            page-break-inside: avoid;
            box-shadow: none;
            border: 1px solid #ddd;
        }
        
        .section-icon {
            background: var(--sou-rosa) !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }
        
        .table-modern thead th {
            background: var(--sou-azul) !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }
        
        .timeline-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #ddd;
            page-break-inside: avoid;
        }
        
        .timeline-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .timeline-section .section-header {
            background: rgba(7, 48, 79, 0.05) !important;
            border-left: 3px solid var(--sou-azul) !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }
    }

    /* === BOT칏ES PROFISSIONAIS === */
    .btn-sou-primary {
        background: linear-gradient(135deg, var(--sou-azul) 0%, var(--sou-azul-claro) 100%);
        border: none;
        color: white;
        font-weight: 600;
        border-radius: 0.5rem;
        padding: 0.5rem 1rem;
        transition: all 0.3s ease;
    }
    
    .btn-sou-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(7, 48, 79, 0.3);
        color: white;
    }
    
    .btn-sou-secondary {
        background: linear-gradient(135deg, var(--sou-rosa) 0%, #ff4569 100%);
        border: none;
        color: white;
        font-weight: 600;
        border-radius: 0.5rem;
        padding: 0.5rem 1rem;
        transition: all 0.3s ease;
    }
    
    .btn-sou-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(255, 45, 95, 0.3);
        color: white;
    }

    /* === SE칂칏ES DE CONTE칔DO === */
    .content-section {
        background: white;
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 0.125rem 0.5rem rgba(0,0,0,0.05);
        border: 1px solid rgba(7, 48, 79, 0.1);
    }

    /* === LINHA DO TEMPO DAS FASES === */
    .phase-timeline-container {
        margin-top: 1.5rem;
        overflow-x: auto;
        padding: 1rem 0;
    }

    .phase-timeline {
        display: flex;
        align-items: flex-start;
        gap: 2rem;
        min-width: 100%;
        position: relative;
    }

    .phase-item {
        flex: 1;
        min-width: 200px;
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .phase-circle {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        margin-bottom: 1rem;
        border: 3px solid;
        background: white;
        z-index: 2;
    }

    .phase-completed .phase-circle {
        border-color: #28a745;
        background: #d4edda;
    }

    .phase-current .phase-circle {
        border-color: var(--sou-azul);
        background: #e3f2fd;
        animation: pulse 2s infinite;
    }

    .phase-pending .phase-circle {
        border-color: #6c757d;
        background: #f8f9fa;
    }

    .phase-number {
        font-size: 1.2rem;
        font-weight: bold;
        position: absolute;
        top: 5px;
        right: 5px;
        background: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        border: 2px solid;
    }

    .phase-completed .phase-number {
        border-color: #28a745;
        color: #28a745;
    }

    .phase-current .phase-number {
        border-color: var(--sou-azul);
        color: var(--sou-azul);
    }

    .phase-pending .phase-number {
        border-color: #6c757d;
        color: #6c757d;
    }

    .phase-icon {
        font-size: 2rem;
    }

    .phase-completed .phase-icon {
        color: #28a745;
    }

    .phase-current .phase-icon {
        color: var(--sou-azul);
    }

    .phase-pending .phase-icon {
        color: #6c757d;
    }

    .phase-content {
        width: 100%;
        max-width: 200px;
    }

    .phase-name {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--sou-azul);
    }

    .phase-progress {
        margin-bottom: 1rem;
    }

    .phase-progress .progress {
        height: 8px;
        border-radius: 4px;
        background-color: #f8f9fa;
    }

    .phase-milestones {
        margin-top: 0.5rem;
    }

    .milestone-item {
        margin-bottom: 0.25rem;
    }

    .milestone-item .badge {
        font-size: 0.75rem;
        margin-right: 0.25rem;
    }

    .phase-connector {
        position: absolute;
        top: 40px;
        left: 50%;
        right: -50%;
        height: 3px;
        background: linear-gradient(to right, #ddd 0%, #ddd 100%);
        z-index: 1;
        transform: translateX(50%);
    }

    .phase-completed + .phase-item .phase-connector {
        background: linear-gradient(to right, #28a745 0%, #ddd 100%);
    }

    .phase-current .phase-connector {
        background: linear-gradient(to right, var(--sou-azul) 0%, #ddd 100%);
    }

    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(7, 48, 79, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(7, 48, 79, 0); }
        100% { box-shadow: 0 0 0 0 rgba(7, 48, 79, 0); }
    }

    /* Responsividade para a linha do tempo - apenas tela */
    @media screen and (max-width: 768px) {
        .phase-timeline {
            flex-direction: column;
            gap: 1rem;
        }
        
        .phase-item {
            min-width: auto;
            width: 100%;
        }
        
        .phase-connector {
            display: none;
        }
    }
    /* === FIM LINHA DO TEMPO DAS FASES === */
    
    .section-header-modern {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--sou-cinza);
    }
    
    .section-icon {
        background: linear-gradient(135deg, var(--sou-rosa) 0%, #ff4569 100%);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-size: 1.1rem;
    }
    
    .section-title-modern {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--sou-azul);
        margin: 0;
    }

    /* === TABELAS PROFISSIONAIS === */
    .table-modern {
        margin-bottom: 0;
    }
    
    .table-modern thead th {
        background: linear-gradient(135deg, var(--sou-azul) 0%, var(--sou-azul-claro) 100%);
        color: white;
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: none;
        padding: 1rem 0.75rem;
    }
    
    .table-modern tbody td {
        vertical-align: middle;
        padding: 0.75rem;
        border-bottom: 1px solid rgba(7, 48, 79, 0.1);
    }
    
    .table-modern tbody tr:hover {
        background-color: rgba(7, 48, 79, 0.02);
    }

    /* === BADGES MODERNOS === */
    .badge-modern {
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        font-weight: 500;
        font-size: 0.75rem;
    }
    
    .badge-success-modern { background-color: #28a745; }
    .badge-warning-modern { background-color: #ffc107; color: #000; }
    .badge-danger-modern { background-color: var(--sou-rosa); }
    .badge-primary-modern { background-color: var(--sou-azul); }
    .badge-info-modern { background-color: var(--sou-azul-claro); }

    /* === ESTILOS PARA PDF === */
    @media print {
        @page {
            size: A4 portrait;
            margin: 1cm;
        }
        
        .pdf-only {
            display: block !important;
        }
        
        .screen-only {
            display: none !important;
        }
        
        .hours-visibility-toggle {
            display: none !important;
        }
        
        .sou-header {
            background: var(--sou-azul) !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }
        
        .kpi-card-modern {
            page-break-inside: avoid;
            box-shadow: none;
            border: 1px solid #ddd;
        }
        
        .content-section {
            page-break-inside: avoid;
            box-shadow: none;
            border: 1px solid #ddd;
        }
        
        .section-icon {
            background: var(--sou-rosa) !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }
        
        .table-modern thead th {
            background: var(--sou-azul) !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }
        
        /* === LINHA DO TEMPO DAS FASES - IMPRESS츾O === */
        .phase-timeline-container {
            overflow-x: visible;
            padding: 1rem 0;
        }

        .phase-timeline {
            display: flex !important;
            flex-direction: row !important;
            align-items: flex-start;
            gap: 1rem; /* Reduzido para caber na impress칚o */
            min-width: 100%;
            position: relative;
        }

        .phase-item {
            flex: 1;
            min-width: 140px; /* Reduzido para caber na impress칚o */
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .phase-circle {
            width: 60px; /* Reduzido para caber na impress칚o */
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 0.75rem;
            border: 2px solid;
            background: white;
            z-index: 2;
        }

        .phase-completed .phase-circle {
            border-color: #28a745 !important;
            background: #d4edda !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        .phase-current .phase-circle {
            border-color: var(--sou-azul) !important;
            background: #e3f2fd !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        .phase-pending .phase-circle {
            border-color: #6c757d !important;
            background: #f8f9fa !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        .phase-number {
            font-size: 1rem;
            font-weight: bold;
            position: absolute;
            top: 3px;
            right: 3px;
            background: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            border: 2px solid;
        }

        .phase-completed .phase-number {
            border-color: #28a745 !important;
            color: #28a745 !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        .phase-current .phase-number {
            border-color: var(--sou-azul) !important;
            color: var(--sou-azul) !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        .phase-pending .phase-number {
            border-color: #6c757d !important;
            color: #6c757d !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        .phase-icon {
            font-size: 1.5rem; /* Reduzido para caber na impress칚o */
        }

        .phase-completed .phase-icon {
            color: #28a745 !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        .phase-current .phase-icon {
            color: var(--sou-azul) !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        .phase-pending .phase-icon {
            color: #6c757d !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        .phase-content {
            width: 100%;
            max-width: 140px; /* Reduzido para caber na impress칚o */
        }

        .phase-name {
            font-size: 0.9rem; /* Reduzido para caber na impress칚o */
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--sou-azul) !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        .phase-progress {
            margin-bottom: 0.75rem;
        }

        .phase-progress .progress {
            height: 6px;
            border-radius: 3px;
            background-color: #f8f9fa !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        .phase-milestones {
            margin-top: 0.5rem;
        }

        .milestone-item {
            margin-bottom: 0.25rem;
        }

        .milestone-item .badge {
            font-size: 0.65rem; /* Reduzido para caber na impress칚o */
            margin-right: 0.25rem;
        }

        .phase-connector {
            position: absolute;
            top: 30px; /* Ajustado para o c칤rculo menor */
            left: 50%;
            right: -50%;
            height: 2px;
            background: linear-gradient(to right, #ddd 0%, #ddd 100%);
            z-index: 1;
            transform: translateX(50%);
        }

        .phase-completed + .phase-item .phase-connector {
            background: linear-gradient(to right, #28a745 0%, #ddd 100%) !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        .phase-current .phase-connector {
            background: linear-gradient(to right, var(--sou-azul) 0%, #ddd 100%) !important;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }

        /* Desabilitar anima칞칚o na impress칚o */
        .phase-current .phase-circle {
            animation: none !important;
        }
        
        /* For칞ar quebra de p치gina ap칩s a linha do tempo se necess치rio */
        .phase-timeline-container {
            page-break-inside: avoid;
        }
        
        /* Sobrescrever regras de responsividade na impress칚o */
        .phase-timeline {
            flex-direction: row !important;
            justify-content: space-between !important;
        }
        
        .phase-item {
            min-width: 140px !important;
            width: auto !important;
            flex-direction: column !important;
        }
        
        .phase-connector {
            display: block !important;
        }
        
        /* Regra espec칤fica para garantir layout horizontal */
        .phase-timeline-container .phase-timeline {
            display: flex !important;
            flex-direction: row !important;
            flex-wrap: nowrap !important;
            justify-content: space-between !important;
        }
        
        .phase-timeline-container .phase-timeline .phase-item {
            flex: 1 !important;
            min-width: 140px !important;
            max-width: 160px !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
        }
    }

    /* === RESPONSIVIDADE === */
    @media (max-width: 768px) {
        .report-title {
            font-size: 2rem;
        }
        
        .project-info-grid {
            grid-template-columns: 1fr;
        }
        
        .hours-visibility-toggle {
            position: relative;
            right: auto;
            top: auto;
            margin-bottom: 1rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    {% if error %}
        <div class="alert alert-danger" role="alert">
            <h4 class="alert-heading">Erro ao Gerar Status Report</h4>
            <p>{{ error }}</p>
        </div>
    {% elif report_data %}
        
        <!-- Toggle de Visibilidade de Horas (s칩 na tela) -->
        <div class="hours-visibility-toggle screen-only" id="hoursToggleContainer">
            <button class="toggle-hide-btn" onclick="hideToggle()" title="Ocultar controle (Ctrl+Shift+M para mostrar)">
                <i class="bi bi-x"></i>
            </button>
            <div class="d-flex align-items-center">
                <span class="me-2 small fw-bold">Modo Cliente:</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="publicModeToggle">
                    <span class="toggle-slider"></span>
                </label>
                <span class="ms-2 small">
                    <span class="private-label">Detalhado</span>
                    <span class="public-label" style="display: none;">P칰blico</span>
                </span>
            </div>
            <small class="text-muted d-block mt-1">
                <span class="private-desc">Mostra valores de horas</span>
                <span class="public-desc" style="display: none;">Oculta valores sens칤veis</span>
            </small>
        </div>

        <!-- Cabe칞alho Principal -->
        <div class="sou-header">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-md-2">
                        <img src="{{ url_for('static', filename='images/sou.cloud.png') }}" alt="SOU.cloud" class="sou-logo">
                    </div>
                    <div class="col-md-8 text-center">
                        <h1 class="report-title">Status Report</h1>
                        <p class="report-subtitle">Relat칩rio Executivo de Acompanhamento</p>
                    </div>
                    <div class="col-md-2 text-end">
                        <div class="screen-only">
                            <a href="{{ url_for('backlog.board_by_project', project_id=project_id) }}" 
                               class="btn btn-sou-secondary btn-sm me-2">
                                <i class="bi bi-kanban me-1"></i> Kanban
                            </a>
                            <button class="btn btn-sou-primary btn-sm" onclick="window.print();">
                                <i class="bi bi-printer me-1"></i> PDF
                            </button>
                        </div>
                        <div class="pdf-only text-white">
                            <strong>Data:</strong> {{ data_geracao | default('N/A', true) }}<br>
                            <strong>Vers칚o:</strong> 1.0
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Container principal que ser치 convertido para PDF -->
        <div id="pdfContent">
            
            <!-- Informa칞칫es do Projeto -->
            <div class="project-info-modern">
                <div class="project-info-grid">
                    <div class="project-info-item">
                        <span class="project-info-label">Projeto</span>
                        <span class="project-info-value">{{ report_data.info_geral.nome | default('N/A') }}</span>
                    </div>
                    <div class="project-info-item">
                        <span class="project-info-label">ID</span>
                        <span class="project-info-value">{{ report_data.info_geral.id | default('N/A') }}</span>
                    </div>
                    <div class="project-info-item">
                        <span class="project-info-label">Squad</span>
                        <span class="project-info-value">{{ report_data.info_geral.squad | default('N/A') }}</span>
                    </div>
                    <div class="project-info-item">
                        <span class="project-info-label">Especialista</span>
                        <span class="project-info-value">{{ report_data.info_geral.especialista | default('N/A') }}</span>
                    </div>
                    <div class="project-info-item">
                        <span class="project-info-label">Account Manager</span>
                        <span class="project-info-value">{{ report_data.info_geral.account_manager | default('N/A') }}</span>
                    </div>
                    <div class="project-info-item">
                        <span class="project-info-label">Prazo</span>
                        <span class="project-info-value">{{ report_data.info_geral.data_vencimento | default('A definir') }}</span>
                    </div>
                    <div class="project-info-item">
                        <span class="project-info-label">Status</span>
                        <span class="project-info-value">{{ report_data.info_geral.status_atual | default('N/A') }}</span>
                    </div>
                </div>
            </div>

            <!-- KPIs Principais -->
            <div class="row mb-4">
                <!-- Status Geral -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card kpi-card-modern kpi-status h-100">
                        <div class="card-body">
                            <i class="bi bi-speedometer2 kpi-icon-modern"></i>
                            <span class="kpi-label">Status Geral</span>
                            {% set status_color_class = report_data.status_geral_indicador | default('cinza') %}
                            {% set status_text_map = {
                                'verde': 'Saud치vel',
                                'amarelo': 'Aten칞칚o',
                                'vermelho': 'Cr칤tico',
                                'azul': 'Conclu칤do',
                                'cinza': 'N칚o Iniciado'
                            } %}
                            <div class="status-indicator">
                                <span class="status-dot-modern status-{{ status_color_class.replace('verde', 'no-prazo').replace('amarelo', 'atencao').replace('vermelho', 'critico').replace('azul', 'concluido') }}"></span>
                                <span class="kpi-value">{{ status_text_map.get(status_color_class, 'N칚o Iniciado') }}</span>
                            </div>
                            <div class="kpi-subtitle">Situa칞칚o atual do projeto</div>
                        </div>
                    </div>
                </div>

                <!-- Progresso -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card kpi-card-modern kpi-progress h-100">
                        <div class="card-body">
                            <i class="bi bi-graph-up kpi-icon-modern"></i>
                            <span class="kpi-label">Progresso</span>
                            <div class="kpi-value">{{ report_data.progresso.percentual_concluido | round(1) }}%</div>
                            <div class="kpi-subtitle">Conclus칚o das atividades</div>
                        </div>
                    </div>
                </div>

                <!-- Status do Prazo -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card kpi-card-modern kpi-schedule h-100">
                        <div class="card-body">
                            <i class="bi bi-calendar-check kpi-icon-modern"></i>
                            <span class="kpi-label">Cronograma</span>
                            <div class="kpi-value" style="font-size: 1.5rem;">{{ report_data.progresso.status_prazo | default('A Definir') }}</div>
                            <div class="kpi-subtitle">Prev: {{ report_data.progresso.data_prevista_termino | default(report_data.info_geral.data_vencimento | default('N/A', true)) }}</div>
                        </div>
                    </div>
                </div>

                <!-- Esfor칞o (com controle de visibilidade) -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card kpi-card-modern kpi-effort h-100">
                        <div class="card-body">
                            <i class="bi bi-hourglass-split kpi-icon-modern"></i>
                            <span class="kpi-label">Esfor칞o</span>
                            
                            <!-- Vers칚o Privada (com valores) -->
                            <div class="hours-private">
                                <div class="kpi-value">{{ report_data.esforco.percentual_consumido | round(1) }}%</div>
                                <div class="kpi-subtitle">{{ report_data.esforco.horas_utilizadas | round(1) }}h / {{ report_data.esforco.horas_planejadas | round(1) }}h</div>
                            </div>
                            
                            <!-- Vers칚o P칰blica (sem valores espec칤ficos) -->
                            <div class="hours-public">
                                {% if report_data.esforco.percentual_consumido | round(1) <= 80 %}
                                    <div class="kpi-value" style="font-size: 1.4rem;">Dentro do Previsto</div>
                                    <div class="kpi-subtitle">Consumo controlado</div>
                                {% elif report_data.esforco.percentual_consumido | round(1) <= 100 %}
                                    <div class="kpi-value" style="font-size: 1.4rem;">Pr칩ximo ao Limite</div>
                                    <div class="kpi-subtitle">Monitoramento ativo</div>
                                {% else %}
                                    <div class="kpi-value" style="font-size: 1.4rem;">Acima do Previsto</div>
                                    <div class="kpi-subtitle">Requer aten칞칚o</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Linha de Gr치ficos (Lado a Lado) -->
            <div class="row">
                <!-- Coluna Esquerda: Gr치fico de Progresso -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow chart-card h-100">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Progresso (% Conclu칤do)</h6>
                        </div>
                        <div class="card-body d-flex justify-content-center align-items-center">
                            <canvas id="progressoChart" style="max-height: 200px;"></canvas>
                        </div>
                    </div>
                </div>
                <!-- Coluna Direita: Gr치fico de Esfor칞o -->
                <div class="col-lg-6 mb-4">
                     <div class="card shadow chart-card h-100">
                        <div class="card-header py-3">
                            <!-- T칤tulo privado (com valores de horas) -->
                            <h6 class="m-0 font-weight-bold text-primary hours-private">Esfor칞o (Horas Planejado vs Utilizado)</h6>
                            <!-- T칤tulo p칰blico (progresso de tarefas) -->
                            <h6 class="m-0 font-weight-bold text-primary hours-public">Progresso das Tarefas</h6>
                        </div>
                        <div class="card-body d-flex justify-content-center align-items-center">
                            <!-- Gr치fico privado (com valores de horas detalhados) -->
                            <canvas id="esforcoChart" class="hours-private" style="max-height: 200px;"></canvas>
                            
                            <!-- Gr치fico p칰blico (tarefas criadas vs conclu칤das) -->
                            <canvas id="tarefasChart" class="hours-public" style="max-height: 200px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Marcos Recentes (Linha inteira) -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="content-section">
                        <div class="section-header-modern">
                            <div class="section-icon">
                                <i class="bi bi-calendar-check"></i>
                            </div>
                            <h6 class="section-title-modern">Marcos Recentes</h6>
                        </div>
                        {% if report_data and report_data.marcos_recentes and report_data.marcos_recentes|length > 0 %}
                            <div class="table-responsive">
                                <table class="table table-modern">
                                    <thead>
                                        <tr>
                                            <th style="width: 50%">Marco</th>
                                            <th style="width: 20%">Status</th>
                                            <th style="width: 30%">Data Planejada</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for marco in report_data.marcos_recentes %}
                                            <tr {% if marco.atrasado %}class="table-danger"{% endif %}>
                                                <td>
                                                    {% if marco.atrasado %}<span class="badge bg-danger me-1" title="Marco atrasado!">!</span>{% endif %}
                                                    <span class="milestone-name">{{ marco.nome | default(marco.title | default('Marco sem nome')) }}</span>
                                                </td>
                                                <td>
                                                    <span class="badge 
                                                        {% if marco.status == 'Conclu칤do' or marco.status == 'Completed' %}bg-success
                                                        {% elif marco.status == 'Em Andamento' or marco.status == 'In Progress' %}bg-primary
                                                        {% elif marco.status == 'Atrasado' or marco.status == 'Delayed' %}bg-danger
                                                        {% else %}bg-secondary{% endif %}">
                                                        {{ marco.status | default('N/A') }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="milestone-date">{{ marco.data_planejada | default(marco.due_date | default('N/A')) }}</span>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <p class="text-muted">Nenhum marco definido para este projeto.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- 游 NOVO: Linha do Tempo das Fases -->
            {% if report_data and report_data.fases_projeto and report_data.fases_projeto|length > 0 %}
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="content-section">
                        <div class="section-header-modern">
                            <div class="section-icon">
                                <i class="bi bi-diagram-3"></i>
                            </div>
                            <h6 class="section-title-modern">Linha do Tempo das Fases</h6>
                        </div>
                        
                        <div class="phase-timeline-container">
                            <div class="phase-timeline">
                                {% for fase in report_data.fases_projeto %}
                                <div class="phase-item phase-{{ fase.status }}">
                                    <div class="phase-circle">
                                        <div class="phase-number">{{ fase.numero }}</div>
                                        {% if fase.status == 'completed' %}
                                            <i class="bi bi-check-circle-fill phase-icon"></i>
                                        {% elif fase.status == 'current' %}
                                            <i class="bi bi-play-circle-fill phase-icon"></i>
                                        {% else %}
                                            <i class="bi bi-circle phase-icon"></i>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="phase-content">
                                        <h6 class="phase-name">{{ fase.nome }}</h6>
                                        <div class="phase-progress">
                                            <div class="progress">
                                                <div class="progress-bar 
                                                    {% if fase.status == 'completed' %}bg-success
                                                    {% elif fase.status == 'current' %}bg-primary
                                                    {% else %}bg-secondary{% endif %}" 
                                                    role="progressbar" 
                                                    style="width: {{ fase.progresso }}%">
                                                    {{ fase.progresso }}%
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {% if fase.marcos and fase.marcos|length > 0 %}
                                        <div class="phase-milestones">
                                            <small class="text-muted">Marcos:</small>
                                            {% for marco in fase.marcos %}
                                            <div class="milestone-item">
                                                <span class="badge 
                                                    {% if marco.status == 'Conclu칤do' %}bg-success
                                                    {% elif marco.status == 'Em Andamento' %}bg-primary
                                                    {% else %}bg-secondary{% endif %}">
                                                    {{ marco.nome }}
                                                </span>
                                                {% if marco.atrasado %}
                                                    <span class="badge bg-danger ms-1">Atrasado</span>
                                                {% endif %}
                                            </div>
                                            {% endfor %}
                                        </div>
                                        {% endif %}
                                    </div>
                                    
                                    {% if not loop.last %}
                                    <div class="phase-connector"></div>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Linha do Tempo (Linha inteira) -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="content-section">
                        <div class="section-header-modern">
                            <div class="section-icon">
                                <i class="bi bi-list-task"></i>
                            </div>
                            <h6 class="section-title-modern">Linha do Tempo (Tarefas)</h6>
                        </div>
                        <div class="card shadow-sm h-100" style="border: none; box-shadow: none !important; background: transparent;">
                            {# Mostrar loading apenas se N츾O for PDF #}
                            <div id="timeline-loading" class="text-center p-3" style="display: none;">
                                <div class="spinner-border spinner-border-sm text-primary me-2" role="status"></div>
                                <span class="text-muted small">Carregando tarefas...</span>
                            </div>
                            
                            <div id="timeline-error" class="text-center p-3 text-danger" style="display: none;">
                                <i class="bi bi-exclamation-circle me-2"></i>
                                <span id="timeline-error-message" class="small">Erro ao carregar tarefas</span>
                            </div>
                            
                            <div id="timeline-empty" class="text-center p-3 text-muted" style="display: none;">
                                <i class="bi bi-info-circle me-2"></i>
                                <span class="small">Nenhuma tarefa encontrada</span>
                            </div>
                            
                            <!-- Lista de tarefas -->
                            {# Mostrar conte칰do da timeline: se for PDF, renderiza direto; sen칚o, JS controla #}
                            <div id="timeline-content" style="display: block;">
                                <!-- Pr칩ximas tarefas - OCULTADO conforme solicitado -->
                                <div class="timeline-section" style="display: none;">
                                    <div class="section-header">
                                        <i class="bi bi-calendar-event text-warning"></i>
                                        <span class="fw-bold">Pr칩ximas Tarefas (7 dias)</span>
                                    </div>
                                    {% if report_data.tarefas_proximo_prazo and report_data.tarefas_proximo_prazo|length > 0 %}
                                        <div class="table-responsive">
                                            <table class="table table-modern">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 35%">Tarefa</th>
                                                        <th style="width: 15%">Prioridade</th>
                                                        <th style="width: 25%">Data In칤cio</th>
                                                        <th style="width: 25%">Prazo Final</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for task in report_data.tarefas_proximo_prazo %}
                                                        <tr>
                                                            <td>
                                                                <span class="timeline-task-name">{{ task.titulo | default('Tarefa sem t칤tulo') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="badge bg-warning text-dark">{{ task.prioridade | default('N/A') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">
                                                                    <i class="bi bi-play-circle text-success"></i> {{ task.data_inicio | default('-') }}
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">
                                                                    <i class="bi bi-flag text-danger"></i> {{ task.data_vencimento | default('-') }}
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center text-muted small p-3">Nenhuma tarefa com prazo nos pr칩ximos 7 dias.</div>
                                    {% endif %}
                                </div>
                                
                                <!-- 1. Tarefas conclu칤das -->
                                <div class="timeline-section">
                                    <div class="section-header">
                                        <i class="bi bi-check-circle text-success"></i>
                                        <span class="fw-bold">Conclu칤das</span>
                                    </div>
                                    {% if report_data.tarefas_concluidas and report_data.tarefas_concluidas|length > 0 %}
                                        <div class="table-responsive">
                                            <table class="table table-modern">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 35%">Tarefa</th>
                                                        <th style="width: 15%">Prioridade</th>
                                                        <th style="width: 25%">Data In칤cio</th>
                                                        <th style="width: 25%">Prazo Final</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for task in report_data.tarefas_concluidas %}
                                                        <tr>
                                                            <td>
                                                                <span class="timeline-task-name">{{ task.titulo | default('Tarefa sem t칤tulo') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="badge bg-success">{{ task.prioridade | default('N/A') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">
                                                                    <i class="bi bi-play-circle text-success"></i> {{ task.data_inicio | default('-') }}
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">
                                                                    <i class="bi bi-flag text-danger"></i> {{ task.data_vencimento | default('-') }}
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center text-muted small p-3">Nenhuma tarefa conclu칤da.</div>
                                    {% endif %}
                                </div>
                                
                                <!-- 2. Tarefas em Revis칚o -->
                                <div class="timeline-section">
                                    <div class="section-header">
                                        <i class="bi bi-search text-info"></i>
                                        <span class="fw-bold">Em Revis칚o</span>
                                    </div>
                                    {% if report_data.tarefas_em_revisao and report_data.tarefas_em_revisao|length > 0 %}
                                        <div class="table-responsive">
                                            <table class="table table-modern">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 35%">Tarefa</th>
                                                        <th style="width: 15%">Prioridade</th>
                                                        <th style="width: 25%">Data In칤cio</th>
                                                        <th style="width: 25%">Prazo Final</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for task in report_data.tarefas_em_revisao %}
                                                        <tr>
                                                            <td>
                                                                <span class="timeline-task-name">{{ task.titulo | default('Tarefa sem t칤tulo') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="badge bg-info">{{ task.prioridade | default('N/A') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">
                                                                    <i class="bi bi-play-circle text-success"></i> {{ task.data_inicio | default('-') }}
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">
                                                                    <i class="bi bi-flag text-danger"></i> {{ task.data_vencimento | default('-') }}
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center text-muted small p-3">Nenhuma tarefa em revis칚o.</div>
                                    {% endif %}
                                </div>
                                
                                <!-- 3. Tarefas em andamento -->
                                <div class="timeline-section">
                                    <div class="section-header">
                                        <i class="bi bi-play-circle text-primary"></i>
                                        <span class="fw-bold">Em Andamento</span>
                                    </div>
                                    {% if report_data.tarefas_em_andamento and report_data.tarefas_em_andamento|length > 0 %}
                                        <div class="table-responsive">
                                            <table class="table table-modern">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 35%">Tarefa</th>
                                                        <th style="width: 15%">Prioridade</th>
                                                        <th style="width: 25%">Data In칤cio</th>
                                                        <th style="width: 25%">Prazo Final</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for task in report_data.tarefas_em_andamento %}
                                                        <tr>
                                                            <td>
                                                                <span class="timeline-task-name">{{ task.titulo | default('Tarefa sem t칤tulo') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="badge bg-primary">{{ task.prioridade | default('N/A')}}</span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">
                                                                    <i class="bi bi-play-circle text-success"></i> {{ task.data_inicio | default('-') }}
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">
                                                                    <i class="bi bi-flag text-danger"></i> {{ task.data_vencimento | default('-') }}
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center text-muted small p-3">Nenhuma tarefa em andamento.</div>
                                    {% endif %}
                                </div>
                                
                                <!-- 4. Tarefas Pendentes -->
                                <div class="timeline-section">
                                    <div class="section-header">
                                        <i class="bi bi-pause-circle text-secondary"></i>
                                        <span class="fw-bold">Pendente</span>
                                    </div>
                                    {% if report_data.tarefas_pendentes and report_data.tarefas_pendentes|length > 0 %}
                                        <div class="table-responsive">
                                            <table class="table table-modern">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 35%">Tarefa</th>
                                                        <th style="width: 15%">Prioridade</th>
                                                        <th style="width: 25%">Data In칤cio</th>
                                                        <th style="width: 25%">Prazo Final</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for task in report_data.tarefas_pendentes %}
                                                        <tr>
                                                            <td>
                                                                <span class="timeline-task-name">{{ task.titulo | default('Tarefa sem t칤tulo') }}</span>
                                                            </td>
                                                            <td>
                                                                {% set priority_class = 'bg-secondary' %}
                                                                {% if task.prioridade == 'Alta' %} {% set priority_class = 'bg-warning text-dark' %}
                                                                {% elif task.prioridade == 'Urgente' %} {% set priority_class = 'bg-danger' %}
                                                                {% elif task.prioridade == 'M칠dia' %} {% set priority_class = 'bg-info' %}
                                                                {% elif task.prioridade == 'Baixa' %} {% set priority_class = 'bg-success' %}{% endif %}
                                                                <span class="badge {{ priority_class }}">{{ task.prioridade | default('N/A')}}</span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">
                                                                    <i class="bi bi-play-circle text-success"></i> {{ task.data_inicio | default('-') }}
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">
                                                                    <i class="bi bi-flag text-danger"></i> {{ task.data_vencimento | default('-') }}
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center text-muted small p-3">Nenhuma tarefa pendente.</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Riscos e Impedimentos (Linha inteira) -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="content-section">
                        <div class="section-header-modern">
                            <div class="section-icon">
                                <i class="bi bi-exclamation-triangle"></i>
                            </div>
                            <h6 class="section-title-modern">Riscos e Impedimentos</h6>
                        </div>
                        {% if report_data and report_data.riscos_impedimentos and report_data.riscos_impedimentos|length > 0 %}
                            <div class="table-responsive">
                                <table class="table table-modern">
                                    <thead>
                                        <tr>
                                            <th style="width: 30%">T칤tulo</th>
                                            <th style="width: 40%">Descri칞칚o do Risco</th>
                                            <th style="width: 15%">Severidade</th>
                                            <th style="width: 15%">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for risco in report_data.riscos_impedimentos %}
                                            <tr>
                                                <td>
                                                    <strong class="risk-title">{{ risco.titulo | default(risco.title | default('Risco sem t칤tulo')) }}</strong>
                                                </td>
                                                <td>
                                                    <div class="risk-description rich-content">{{ risco.descricao | default('Sem descri칞칚o') | safe }}</div>
                                                </td>
                                                <td>
                                                    <span class="badge 
                                                        {% if risco.severidade == 'Cr칤tico' or risco.severidade == 'Critico' %}bg-danger
                                                        {% elif risco.severidade == 'Alto' or risco.severidade == 'Alta' %}bg-danger
                                                        {% elif risco.severidade == 'M칠dio' or risco.severidade == 'Medio' or risco.severidade == 'M칠dia' %}bg-warning text-dark
                                                        {% elif risco.severidade == 'Baixo' or risco.severidade == 'Baixa' %}bg-success
                                                        {% else %}bg-secondary{% endif %}">
                                                        {{ risco.severidade | default('N/A') }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="badge 
                                                        {% if risco.status == 'Ativo' %}bg-warning text-dark
                                                        {% elif risco.status == 'Resolvido' %}bg-success
                                                        {% elif risco.status == 'Mitigado' %}bg-info
                                                        {% elif risco.status == 'Em Monitoramento' %}bg-info
                                                        {% else %}bg-secondary{% endif %}">
                                                        {{ risco.status | default('N/A') }}
                                                    </span>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <p class="text-muted">Nenhum risco ou impedimento identificado para este projeto.</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Notas e Observa칞칫es (Linha inteira) -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="content-section">
                        <div class="section-header-modern">
                            <div class="section-icon">
                                <i class="bi bi-journal-text"></i>
                            </div>
                            <h6 class="section-title-modern">Notas e Observa칞칫es</h6>
                        </div>
                        {% if report_data and report_data.notas and report_data.notas|length > 0 %}
                            <div class="card">
                                <div class="list-group list-group-flush note-section">
                                    {% for nota in report_data.notas %}
                                        <div class="list-group-item">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div class="flex-grow-1">
                                                    <div class="mb-2">
                                                        <span class="badge badge-modern
                                                            {% if nota.categoria == 'decision' %}badge-primary-modern
                                                            {% elif nota.categoria == 'impediment' %}badge-danger-modern
                                                            {% elif nota.categoria == 'general' %}badge-info-modern
                                                            {% else %}badge-info-modern{% endif %} me-1">
                                                            {% if nota.categoria == 'decision' %}Decis칚o
                                                            {% elif nota.categoria == 'impediment' %}Impedimento
                                                            {% elif nota.categoria == 'general' %}Geral
                                                            {% else %}{{ nota.categoria | title }}{% endif %}
                                                        </span>
                                                        {% if nota.prioridade %}
                                                            <span class="badge 
                                                                {% if nota.prioridade == 'Alta' %}bg-danger
                                                                {% elif nota.prioridade == 'M칠dia' %}bg-warning text-dark
                                                                {% elif nota.prioridade == 'Baixa' %}bg-success
                                                                {% else %}bg-secondary{% endif %} me-1">
                                                                {{ nota.prioridade }}
                                                            </span>
                                                        {% endif %}
                                                    </div>
                                                    <div class="note-content rich-content">{{ nota.conteudo | default('Nota sem conte칰do') | safe }}</div>
                                                    {% if nota.data_exibicao %}
                                                        <small class="text-muted">{{ nota.data_exibicao }}</small>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% else %}
                            <p class="text-muted">Nenhuma nota ou observa칞칚o registrada para este projeto.</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Pr칩ximos Passos (Linha inteira) - COMENTADO PARA IMPLEMENTA칂츾O FUTURA -->
            <!--
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="placeholder-section">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-arrow-right-circle text-success me-2"></i>
                            <h6 class="section-title mb-0">Pr칩ximos Passos</h6>
                        </div>
                        {% if report_data and report_data.proximos_passos and report_data.proximos_passos|length > 0 %}
                            <div class="card">
                                <div class="list-group list-group-flush">
                                    {% for passo in report_data.proximos_passos %}
                                        <div class="list-group-item">
                                            <div class="d-flex align-items-start">
                                                <i class="bi bi-arrow-right text-primary me-2 mt-1"></i>
                                                <div class="flex-grow-1">
                                                    <h6 class="mb-1">{{ passo.titulo | default('Passo sem t칤tulo') }}</h6>
                                                    {% if passo.descricao %}
                                                        <p class="mb-1">{{ passo.descricao }}</p>
                                                    {% endif %}
                                                    {% if passo.prazo %}
                                                        <small class="text-muted">
                                                            <i class="bi bi-calendar me-1"></i>Prazo: {{ passo.prazo }}
                                                        </small>
                                                    {% endif %}
                                                    {% if passo.responsavel %}
                                                        <small class="text-muted ms-3">
                                                            <i class="bi bi-person me-1"></i>{{ passo.responsavel }}
                                                        </small>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% else %}
                            <p class="text-muted">Nenhum pr칩ximo passo definido para este projeto.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            -->

            <!-- Rodap칠 da empresa (apenas para PDF) -->
            <div class="company-footer pdf-only">
                <div class="footer-line"><strong>Control360.SOU - Project Management Office</strong></div>
                <div class="footer-line">Relat칩rio gerado automaticamente pelo sistema PMO</div>
                <div class="footer-line">Data: {{ data_geracao | default('N/A', true) }}</div>
            </div>

            </div> <!-- Fim do pdfContent -->
        </div>
    {% else %}
        <p>Nenhum dado de relat칩rio dispon칤vel.</p>
    {% endif %}
</div>

<script>
// Fun칞칚o para carregar dados das tarefas quando n칚o 칠 PDF
document.addEventListener('DOMContentLoaded', function() {
    console.log('Status Report - DOM carregado');
    
    // Verificar se n칚o 칠 visualiza칞칚o PDF
    const isForPdf = {{ 'true' if for_pdf else 'false' }};
    
    if (!isForPdf) {
        console.log('Modo n칚o-PDF detectado, mostrando conte칰do das tarefas...');
        
        // Ocultar loading e mostrar conte칰do
        const timelineLoading = document.getElementById('timeline-loading');
        const timelineContent = document.getElementById('timeline-content');
        
        if (timelineLoading) {
            timelineLoading.style.display = 'none';
        }
        
        if (timelineContent) {
            timelineContent.style.display = 'block';
        }
        
        console.log('Timeline content exibido com sucesso');
    }
    
    // Carregar gr치ficos
    initCharts();
    
    // Inicializar toggle de visibilidade de horas
    initHoursVisibilityToggle();
    
    // Inicializar gr치fico p칰blico de tarefas (s칩 quando necess치rio)
    // initPublicTasksChart(); // Ser치 chamado pelo toggle quando necess치rio
});

// Vari치veis globais para controlar gr치ficos
let tarefasChartInstance = null;

// Fun칞칚o para controlar a visibilidade de informa칞칫es de horas
function initHoursVisibilityToggle() {
    const toggle = document.getElementById('publicModeToggle');
    const body = document.body;
    const privateLabel = document.querySelector('.private-label');
    const publicLabel = document.querySelector('.public-label');
    const privateDesc = document.querySelector('.private-desc');
    const publicDesc = document.querySelector('.public-desc');
    
    if (!toggle) return;
    
    // Garantir estado inicial correto
    if (!toggle.checked) {
        body.classList.remove('public-mode');
    }
    
    toggle.addEventListener('change', function() {
        if (this.checked) {
            // Modo p칰blico - ocultar valores sens칤veis
            body.classList.add('public-mode');
            privateLabel.style.display = 'none';
            publicLabel.style.display = 'inline';
            privateDesc.style.display = 'none';
            publicDesc.style.display = 'block';
            
            // Criar gr치fico de tarefas se ainda n칚o existe
            if (!tarefasChartInstance) {
                console.log('Criando gr치fico de tarefas...');
                initPublicTasksChart();
            } else {
                console.log('Gr치fico de tarefas j치 existe, reutilizando...');
            }
            
            console.log('Modo p칰blico ativado - valores de horas ocultos');
            console.log('Classe public-mode aplicada:', body.classList.contains('public-mode'));
        } else {
            // Modo privado - mostrar valores detalhados
            body.classList.remove('public-mode');
            privateLabel.style.display = 'inline';
            publicLabel.style.display = 'none';
            privateDesc.style.display = 'block';
            publicDesc.style.display = 'none';
            
            console.log('Modo privado ativado - valores de horas vis칤veis');
            console.log('Classe public-mode removida:', !body.classList.contains('public-mode'));
        }
    });
    
    console.log('Toggle de visibilidade de horas inicializado');
    
    // Debug do estado inicial
    console.log('Estado inicial do toggle:', toggle.checked);
    console.log('Classe public-mode inicial:', document.body.classList.contains('public-mode'));
    console.log('Canvas esfor칞o vis칤vel:', document.getElementById('esforcoChart') ? 'SIM' : 'N츾O');
    console.log('Canvas tarefas vis칤vel:', document.getElementById('tarefasChart') ? 'SIM' : 'N츾O');
}

// Fun칞칚o para inicializar o gr치fico p칰blico de tarefas
function initPublicTasksChart() {
    const tarefasCtx = document.getElementById('tarefasChart');
    if (!tarefasCtx) {
        console.log('Canvas de tarefas n칚o encontrado');
        return;
    }
    
    // Verificar se estamos realmente em modo p칰blico
    if (!document.body.classList.contains('public-mode')) {
        console.log('Tentativa de criar gr치fico de tarefas fora do modo p칰blico - ignorando');
        return;
    }
    
    console.log('Iniciando cria칞칚o do gr치fico de tarefas em modo p칰blico...');
    
    // Usar dados reais das tarefas do backend
    const reportData = {
        // Dados de contagem de tarefas reais - a serem implementados no backend
        {% if report_data.contagem_tarefas %}
        contagem_tarefas: {
            total: {{ report_data.contagem_tarefas.total | default(0) }},
            concluidas: {{ report_data.contagem_tarefas.concluidas | default(0) }},
            restantes: {{ report_data.contagem_tarefas.restantes | default(0) }}
        }
        {% else %}
                 // Fallback: calcular baseado nas listas de tarefas dispon칤veis
         contagem_tarefas: {
             concluidas: {{ (report_data.tarefas_concluidas | length) if report_data.tarefas_concluidas else 0 }},
             em_andamento: {{ (report_data.tarefas_em_andamento | length) if report_data.tarefas_em_andamento else 0 }},
             proximo_prazo: {{ (report_data.tarefas_proximo_prazo | length) if report_data.tarefas_proximo_prazo else 0 }},
             em_revisao: {{ (report_data.tarefas_em_revisao | length) if report_data.tarefas_em_revisao else 0 }},
             pendentes: {{ (report_data.tarefas_pendentes | length) if report_data.tarefas_pendentes else 0 }},
             // Fallback para usar progresso se as listas estiverem vazias
             usar_progresso_fallback: true,
             percentual_progresso: {{ report_data.progresso.percentual_concluido | default(0) | round(1) }}
         }
        {% endif %}
    };
    
    let tarefasConcluidas, tarefasRestantes;
    
    {% if report_data.contagem_tarefas %}
    // Usar dados diretos do backend se dispon칤veis
    tarefasConcluidas = reportData.contagem_tarefas.concluidas;
    tarefasRestantes = reportData.contagem_tarefas.restantes;
         {% else %}
     // Calcular baseado nas listas de tarefas dispon칤veis
     tarefasConcluidas = reportData.contagem_tarefas.concluidas;
     const tarefasNaoConcluidas = 
         reportData.contagem_tarefas.em_andamento + 
         reportData.contagem_tarefas.proximo_prazo + 
         reportData.contagem_tarefas.em_revisao + 
         reportData.contagem_tarefas.pendentes;
     tarefasRestantes = tarefasNaoConcluidas;
     
     // Se todas as listas est칚o vazias, usar progresso como fallback
     const totalTarefasContadas = tarefasConcluidas + tarefasRestantes;
     if (totalTarefasContadas === 0 && reportData.contagem_tarefas.usar_progresso_fallback) {
         console.log('Listas de tarefas vazias, usando progresso como fallback...');
         const percentual = reportData.contagem_tarefas.percentual_progresso;
         const estimativa = 15; // Base estimada
         tarefasConcluidas = Math.round((percentual / 100) * estimativa);
         tarefasRestantes = estimativa - tarefasConcluidas;
         console.log('Fallback aplicado:', tarefasConcluidas, 'conclu칤das de', estimativa);
     }
     {% endif %}
    
    // Garantir valores m칤nimos para visualiza칞칚o
    const tarefasConcluidasDisplay = Math.max(0, tarefasConcluidas);
    const tarefasRestantesDisplay = Math.max(1, tarefasRestantes);
    const totalTarefas = tarefasConcluidasDisplay + tarefasRestantesDisplay;
    
    tarefasChartInstance = new Chart(tarefasCtx, {
        type: 'doughnut',
        data: {
            labels: ['Conclu칤das', 'Restantes'],
            datasets: [{
                data: [tarefasConcluidasDisplay, tarefasRestantesDisplay],
                backgroundColor: [
                    '#07304F', // Azul SOU.cloud para conclu칤das
                    '#e3e6f0'  // Cinza para restantes
                ],
                borderWidth: 3,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '60%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 15,
                        usePointStyle: true,
                        font: {
                            size: 12
                        },
                        generateLabels: function(chart) {
                            const data = chart.data;
                            if (data.labels.length && data.datasets.length) {
                                return data.labels.map((label, i) => {
                                    const value = data.datasets[0].data[i];
                                    const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(0);
                                    return {
                                        text: `${label}: ${value} (${percentage}%)`,
                                        fillStyle: data.datasets[0].backgroundColor[i],
                                        strokeStyle: data.datasets[0].backgroundColor[i],
                                        pointStyle: 'circle'
                                    };
                                });
                            }
                            return [];
                        }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((context.parsed / total) * 100).toFixed(1);
                            return `${context.label}: ${context.parsed} (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });
    
    console.log('游늵 GR츼FICO DE TAREFAS INICIALIZADO:');
    console.log('九 Conclu칤das:', tarefasConcluidasDisplay);
    console.log('낍 Restantes:', tarefasRestantesDisplay); 
    console.log('游늳 Total:', totalTarefas);
    console.log('游늶 Dados brutos:', reportData.contagem_tarefas);
    console.log('游뒆勇 Canvas:', !!tarefasCtx);
    console.log('游늵 Chart.js:', !!tarefasChartInstance);
    
    // Alerta se os dados parecem incorretos
    if (totalTarefas < 5) {
        console.warn('丘멆잺 ATEN칂츾O: Total de tarefas muito baixo. Pode indicar problema nos dados do backend.');
    }
}

function initCharts() {
    // Dados do relat칩rio
    const reportData = {
        progresso: {
            percentual_concluido: {{ report_data.progresso.percentual_concluido | default(0) | round(1) }},
        },
        esforco: {
            horas_utilizadas: {{ report_data.esforco.horas_utilizadas | default(0) | round(1) }},
            horas_planejadas: {{ report_data.esforco.horas_planejadas | default(0) | round(1) }},
            percentual_consumido: {{ report_data.esforco.percentual_consumido | default(0) | round(1) }}
        }
    };
    
    console.log('Dados para gr치ficos:', reportData);
    
    // Gr치fico de Progresso (Doughnut)
    const progressoCtx = document.getElementById('progressoChart');
    if (progressoCtx) {
        const percentualConcluido = reportData.progresso.percentual_concluido;
        const percentualRestante = 100 - percentualConcluido;
        
        new Chart(progressoCtx, {
            type: 'doughnut',
            data: {
                labels: ['Conclu칤do', 'Restante'],
                datasets: [{
                    data: [percentualConcluido, percentualRestante],
                    backgroundColor: [
                        '#1cc88a', // Verde para conclu칤do
                        '#e3e6f0'  // Cinza para restante
                    ],
                    borderWidth: 2,
                    borderColor: '#ffffff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '60%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + '%';
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Gr치fico de Esfor칞o (Bar)
    const esforcoCtx = document.getElementById('esforcoChart');
    if (esforcoCtx) {
        const horasUtilizadas = reportData.esforco.horas_utilizadas;
        const horasPlanejadas = reportData.esforco.horas_planejadas;
        const horasRestantes = Math.max(0, horasPlanejadas - horasUtilizadas);
        
        new Chart(esforcoCtx, {
            type: 'bar',
            data: {
                labels: ['Horas'],
                datasets: [
                    {
                        label: 'Utilizadas',
                        data: [horasUtilizadas],
                        backgroundColor: '#4e73df',
                        borderColor: '#4e73df',
                        borderWidth: 1
                    },
                    {
                        label: 'Restantes',
                        data: [horasRestantes],
                        backgroundColor: '#e3e6f0',
                        borderColor: '#e3e6f0',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: true,
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        stacked: true,
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value + 'h';
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.y + 'h';
                            }
                        }
                    }
                }
            }
        });
    }
}

// === CONTROLE DE VISIBILIDADE DO TOGGLE ===
function hideToggle() {
    const toggleContainer = document.getElementById('hoursToggleContainer');
    if (toggleContainer) {
        toggleContainer.classList.add('hidden');
        // Salvar no localStorage que est치 oculto
        localStorage.setItem('toggleHidden', 'true');
    }
}

function showToggle() {
    const toggleContainer = document.getElementById('hoursToggleContainer');
    if (toggleContainer) {
        toggleContainer.classList.remove('hidden');
        // Salvar no localStorage que est치 vis칤vel
        localStorage.setItem('toggleHidden', 'false');
    }
}

// Combina칞칚o de teclas Ctrl+Shift+M para mostrar o toggle
document.addEventListener('keydown', function(event) {
    if (event.ctrlKey && event.shiftKey && event.key === 'M') {
        event.preventDefault();
        const toggleContainer = document.getElementById('hoursToggleContainer');
        if (toggleContainer && toggleContainer.classList.contains('hidden')) {
            showToggle();
        }
    }
});

// Verificar localStorage ao carregar a p치gina
document.addEventListener('DOMContentLoaded', function() {
    const isHidden = localStorage.getItem('toggleHidden') === 'true';
    if (isHidden) {
        const toggleContainer = document.getElementById('hoursToggleContainer');
        if (toggleContainer) {
            toggleContainer.classList.add('hidden');
        }
    }
});
</script>

<!-- Carregar Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}