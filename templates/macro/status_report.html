{% extends "base.html" %}

{% block title %}{{ titulo_pagina if titulo_pagina else 'Status Report' }}{% endblock %}

{% block extra_css %}
{{ super() }}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
<style>
    /* Classes para controlar visibilidade na tela e no PDF */
    .pdf-only {
        display: none; /* Oculta elementos que devem aparecer apenas no PDF */
    }
    
    /* Estilos gerais */
    .status-dot {
        height: 25px;
        width: 25px;
        border-radius: 50%;
        display: inline-block;
        vertical-align: middle;
        margin-right: 8px;
        border: 3px solid #fff;
        box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .status-verde { background-color: #1cc88a; } /* Verde do template */
    .status-amarelo { background-color: #f6c23e; } /* Amarelo do template */
    .status-vermelho { background-color: #e74a3b; } /* Vermelho do template */
    .status-azul { background-color: #36b9cc; } /* Azul para concluído */
    .status-cinza { background-color: #858796; } /* Cinza do template */
    .status-text { font-weight: 600; font-size: 1.1rem; }
    
    /* Layout original do projeto */
    .project-details-header {
        font-size: 0.85rem;
        color: #5a5c69;
        margin-bottom: 1.5rem;
        padding: 0.8rem;
        background-color: #f8f9fc;
        border-radius: 0.35rem;
        border: 1px solid #e3e6f0;
        display: flex; /* Adicionado para garantir o comportamento flex */
        flex-wrap: wrap; /* Permite que os itens quebrem para a próxima linha */
        align-items: center; /* Alinha os itens verticalmente */
    }
    
    .project-details-header strong {
        margin-right: 5px;
    }
    
    .project-details-header span {
        margin-right: 20px; /* Aumentar um pouco o espaço entre os itens */
        margin-bottom: 8px; /* Adicionar espaço inferior para quando quebrar a linha */
        white-space: nowrap; /* Evitar que o texto do item quebre no meio */
    }
    
    /* KPI cards originais */
    .kpi-card .card-body {
        display: flex;
        align-items: center;
        height: 85px;
        padding: 0.5rem 0.8rem;
    }
    
    .kpi-card .kpi-content {
        width: 100%;
        margin-left: 0.8rem;
        text-align: left; /* Adicionado para alinhar conteúdo à esquerda */
    }
    
    .kpi-card .kpi-icon {
        font-size: 1.8rem;
        color: #dddfeb;
    }
    
    .kpi-card .text-xs {
        font-size: 0.65rem;
        display: block;
        margin-bottom: -2px;
    }
    
    .kpi-card .h1, .kpi-card .h5 {
        font-size: 1.4rem;
        margin-bottom: 0;
        line-height: 1.1;
    }
    
    .kpi-card small.text-muted {
        font-size: 0.65rem;
        line-height: 1;
        display: block;
        margin-top: 1px;
    }
    
    /* Charts originais */
    .chart-card .card-body {
        min-height: 220px; /* Altura original */
        padding: 0.8rem; /* Revertido para padding original/simples */
        /* Removidos display:flex e outros que podem ter causado estreitamento */
    }
    
    .chart-card canvas {
        max-height: 200px; /* Reativado */
        min-height: 180px; /* Mantido, pode ser !important se necessário */
        /* Removidos min-width e max-width % para deixar o Chart.js gerenciar mais */
    }
    
    /* Títulos de seções */
    .section-title {
        font-size: 1rem;
        font-weight: 600;
        color: #5a5c69;
        margin-bottom: 0.5rem;
        padding-bottom: 0.4rem;
        border-bottom: 1px solid #e3e6f0;
    }
    
    /* Placeholders originais */
    .placeholder-section {
        background-color: #f8f9fc;
        border: 1px dashed #d1d3e2;
        padding: 1rem;
        border-radius: 0.35rem;
        text-align: center;
        color: #858796;
        margin-top: 1rem;
        font-size: 0.85rem;
    }
    
    .placeholder-section i {
        font-size: 1.2rem;
        margin-bottom: 0.4rem;
        display: block;
    }
    
    .placeholder-section h6 {
        font-size: 0.9rem;
    }
    
    .list-group-item {
        background-color: transparent;
        border-left: none;
        border-right: none;
        border-top: 1px solid #e3e6f0;
        padding: 0.6rem 0;
        font-size: 0.85rem;
    }
    
    .list-group-item:first-child {
        border-top: none;
    }
    
    /* Estilos para campos editáveis */
    .editable-field {
        padding: 2px 5px;
        border-radius: 3px;
        transition: background-color 0.2s;
    }
    
    .edit-mode .editable-field {
        border: 1px dashed #4e73df;
        background-color: rgba(78, 115, 223, 0.1);
        cursor: pointer;
    }
    
    .editable-field.editing {
        background-color: white !important;
        border: 1px solid #4e73df !important;
        padding: 1px 4px;
    }
    
    /* Estilo para o botão de modo de edição ativo */
    #editModeBtn.active {
        background-color: #e74a3b;
        border-color: #e74a3b;
        color: white;
    }
    
    /* Estilo para entrada de edição */
    .edit-input {
        width: 100%;
        border: none;
        background: transparent;
        font-size: inherit;
        font-weight: inherit;
        color: inherit;
        padding: 0;
        margin: 0;
    }
    
    .edit-input:focus {
        outline: none;
    }

    /* --- Estilos para Geração de PDF (WeasyPrint) --- */
    @media print {
        @page {
            size: A4 portrait;
            margin: 3mm !important; /* Margens mínimas reduzidas */
        }

        body {
            background-color: #fff !important;
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }

        /* --- Controle de Visibilidade Essencial para Impressão do Navegador --- */
        .screen-only,
        .navbar, 
        #accordionSidebar, 
        footer.sticky-footer, 
        .scroll-to-top,
        #editModeBtn, 
        #generatePdfBtn, /* Botão do html2pdf.js */
        button.btn-outline-secondary.ms-2[onclick="window.print();"], /* Botão "Imprimir" específico */
        a.btn.btn-sm.btn-primary[title*='Baixar Relatório em PDF'], /* Botão "Baixar PDF (Servidor)" */
        .d-sm-flex.align-items-center.justify-content-between.mb-3 > .screen-only, /* Container dos botões no header da página */
        .d-sm-flex.align-items-center.justify-content-between.mb-3 > h1.h3.text-gray-800 /* Oculta o H1 original na impressão */
        {
            display: none !important;
        }

        .pdf-only { /* Elementos que SÓ devem aparecer em qualquer tipo de PDF/impressão */
            display: block !important; 
        }

        /* Evitar quebras indesejadas DENTRO de seções importantes */
        .placeholder-section, .card, .timeline-section, .table-responsive > table {
            page-break-inside: avoid !important;
        }

        /* Evitar quebra de página ANTES de um rodapé da empresa, se possível */
        .company-footer.pdf-only {
            page-break-before: auto !important; 
        }

        /* Estilos para o cabeçalho da empresa na impressão do navegador */
        /* ANTIGO CABEÇALHO - SERÁ OCULTADO ABAIXO */
        /* .company-header.pdf-only { ... } */
        /* .company-header.pdf-only .print-logo { ... } */
        /* .company-header.pdf-only .company-header-text { ... } */
        /* .company-header.pdf-only .company-logo { ... } */
        /* .company-header.pdf-only .report-date-print { ... } */

        /* NOVO LAYOUT DO CABEÇALHO DE IMPRESSÃO */
        .print-header-layout.pdf-only {
            display: flex !important;
            flex-direction: column !important;
            align-items: flex-start !important; /* Alinha blocos internos (logo-area, company-info-area) à esquerda */
            width: 100% !important;
            margin-bottom: 10px !important; /* Reduzido para menos espaço antes dos detalhes do projeto */
        }

        .print-header-layout.pdf-only .print-logo-area {
            width: 100%; 
            display: flex !important;
            justify-content: flex-start !important; /* Alinha o logo à esquerda */
            margin-bottom: 10px !important;
        }

        .print-header-layout.pdf-only .print-logo-large {
            max-height: 30px !important; /* Tamanho do logo reduzido */
            width: auto !important;
            opacity: 0.9 !important; 
        }

        .print-header-layout.pdf-only .company-info-area {
            width: 100%;
            display: flex !important;
            flex-direction: column !important;
            align-items: flex-start !important; /* Alinha "Control360" e "Data" à esquerda */
            margin-bottom: 10px !important; /* Espaço entre info empresa e título Status Report */
        }

        .print-header-layout.pdf-only .company-name {
            font-size: 10pt !important; 
            font-weight: bold !important;
            color: #444 !important;
            margin-bottom: 3px !important;
        }

        .print-header-layout.pdf-only .report-date {
            font-size: 8pt !important;
            color: #666 !important;
        }
        
        .print-header-layout.pdf-only .print-title-area {
            width: 100% !important;
            text-align: center !important; /* Centraliza o título "Status Report" */
            margin-bottom: 15px !important; /* Espaço após o título */
            padding-bottom: 10px !important; /* Espaço para a borda */
            border-bottom: 1px solid #e3e6f0 !important; /* Borda abaixo do título */
        }

        .print-header-layout.pdf-only .print-main-title {
            font-size: 1.6rem !important; 
            font-weight: 600 !important;
            color: #333 !important;
            margin: 0 !important;
        }

        /* Comentar ou remover regras para o antigo .company-header.pdf-only se não forem mais necessárias */
        /*
        .company-header.pdf-only,
        .company-header.pdf-only .print-logo,
        .company-header.pdf-only .company-header-text,
        .company-header.pdf-only .company-logo,
        .company-header.pdf-only .report-date-print {
            display: none !important;
        }
        */

        /* Estilos para a linha de informações do projeto na impressão do navegador */
        .project-info-line.pdf-only {
            font-size: 8.5pt !important;
            padding: 4px 0px !important; /* Mantém padding vertical, zero horizontal */
            margin-bottom: 30px !important;
            text-align: left !important;
            width: 100% !important;
            box-sizing: border-box !important;
            padding-left: 0 !important; /* Garante que não haja padding esquerdo */
            display: block !important; /* Adicionado para garantir o comportamento de bloco */
        }

    }
    
    /* NOVO: Adicionar estilo para status pendente mais visível */
    .badge-pending {
        background-color: #6c757d !important;
        color: white !important;
    }
    
    /* NOVO: Melhores estilos para tabela de marcos */
    .milestone-name {
        font-weight: 600 !important;
        color: #333 !important;
        text-align: left !important;
        display: inline-block !important;
    }
    
    .milestone-date {
        color: #666 !important;
        font-size: 0.85em !important;
        text-align: right !important;
        display: block !important;
    }

    /* Classe para estilo ao gerar PDF via browser */
    .print-mode {
        font-size: 8pt !important;
        line-height: 1.3 !important;
        width: 210mm !important; /* Largura exata do A4 */
        box-sizing: border-box !important;
        padding: 0 !important;
        margin: 0 auto !important;
    }
    
    .print-mode .company-header {
        margin-bottom: 10px !important;
        padding-bottom: 5px !important;
        border-bottom: 1px solid #4e73df !important;
        display: flex; /* Usar flexbox para alinhar os itens */
        flex-direction: column; /* Empilhar verticalmente */
        align-items: flex-start; /* Alinhar itens à esquerda */
        width: 100% !important; /* Garantir largura total */
        box-sizing: border-box !important; /* Incluir padding e border na largura total */
        /* padding-left: 25pt !important; */ /* Removido para alinhar à esquerda da página */
    }
    
    .print-mode .company-logo {
        font-size: 12pt !important;
        font-weight: bold; /* Adicionado para destacar */
        margin-bottom: 3px; /* Espaço entre logo e data do relatório */
    }

    .print-mode .report-date-print { /* Nova classe para estilizar a data do relatório */
        font-size: 8pt !important;
        color: #666 !important;
        /* align-self: flex-end; */ /* Removido para alinhar à esquerda com o pai */
        /* margin-top: -1.5em; */ /* Removido */
    }
    
    .print-mode .project-info-line {
        font-size: 7.8pt !important; /* Reduzido de 8.5pt */
        padding: 4px 0px !important; /* Ajustando padding, removendo lateral */
        margin-bottom: 30px !important; /* Aumentando margem inferior para mais espaço */
        text-align: left !important; /* Garantindo alinhamento à esquerda */
        width: 100% !important; /* Garantir largura total */
        box-sizing: border-box !important; /* Incluir padding na largura total */
        /* padding-left: 25pt !important; */ /* Removido para alinhar à esquerda da página */
    }
    
    .print-mode .row {
        margin-left: -5px !important;
        margin-right: -5px !important;
        margin-bottom: 8px !important;
    }
    
    .print-mode .col-xl-3,
    .print-mode .col-md-6,
    .print-mode .col-lg-6,
    .print-mode .col-md-4 {
        padding-left: 5px !important;
        padding-right: 5px !important;
    }
    
    .print-mode .status-dot {
        height: 10px !important;
        width: 10px !important;
        border-width: 1px !important;
        margin-right: 3px !important;
    }
    
    .print-mode .kpi-card {
        margin-bottom: 8px !important;
    }
    
    .print-mode .kpi-card .card-body {
        height: auto !important;
        min-height: 50px !important;
        padding: 4px 6px !important;
    }
    
    .print-mode .kpi-card .kpi-icon {
        font-size: 1rem !important;
    }
    
    .print-mode .kpi-card .text-xs {
        font-size: 6pt !important;
    }
    
    .print-mode .kpi-card .h1 {
        font-size: 12pt !important;
    }
    
    .print-mode .kpi-card .h5 {
        font-size: 10pt !important;
    }
    
    .print-mode .kpi-card small.text-muted { 
        font-size: 6pt !important; 
    }
    
    .print-mode .card-header {
        padding: 3px 6px !important;
    }
    
    .print-mode .card-header h6 {
        font-size: 10pt !important;
        margin: 0 !important;
    }
    
    .print-mode .chart-card .card-body {
        min-height: 150px !important;
        padding: 5px !important;
    }
    
    .print-mode canvas {
        max-height: 140px !important;
        max-width: none !important;
    }
    
    .print-mode .placeholder-section {
        height: 80px !important;
        padding: 5px !important;
        margin-top: 5px !important;
    }
    
    .print-mode .placeholder-section i {
        font-size: 0.8rem !important;
        margin-bottom: 2px !important;
    }
    
    .print-mode .placeholder-section h6 {
        font-size: 8pt !important;
        margin-bottom: 3px !important;
    }
    
    .print-mode .placeholder-section p {
        font-size: 7pt !important;
        margin-bottom: 0 !important;
    }
    
    .print-mode .company-footer {
        margin-top: 10px !important;
        padding-top: 5px !important;
        font-size: 7pt !important;
        page-break-before: auto; /* Evitar quebra de página antes se não for necessário */
    }
    
    .print-mode .company-footer p {
        margin-bottom: 2px !important;
    }

    .print-mode .chart-card {
        margin-bottom: 8px !important;
    }

    .print-mode .chart-card .card-body {
        min-height: 135px !important;
        max-height: 150px !important;
        padding: 5px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    /* Timeline estilo tabular (igual Marcos) */
    .timeline-section {
        margin-bottom: 15px !important;
        border: 1px solid #e3e6f0 !important;
        border-radius: 0.25rem !important;
        overflow: hidden !important;
    }

    .timeline-section .section-header {
        padding: 8px 12px !important;
        margin: 0 !important;
        background-color: #f8f9fa !important;
        border-bottom: 1px solid #e9ecef !important;
        font-weight: 600 !important;
        color: #495057 !important;
        text-align: left !important;
        display: flex !important;
        align-items: center !important;
    }
    
    .timeline-section .section-header i {
        margin-right: 8px !important;
        font-size: 1rem !important;
    }
    
    .timeline-section .section-header span {
        line-height: 1.2 !important;
        font-size: 0.85rem !important;
    }
    
    /* Cabeçalho da tabela de timeline */
    .timeline-section .column-headers {
        display: flex !important;
        padding: 6px 12px !important;
        font-size: 0.7rem !important;
        font-weight: 700 !important;
        background-color: #eef0f2 !important;
        border-bottom: 1px solid #dee2e6 !important;
        color: #555 !important;
    }
    
    .timeline-section .column-headers .task-column {
        flex: 0 0 50% !important;
        text-align: left !important;
        padding-left: 0 !important;
    }
    
    .timeline-section .column-headers .status-column {
        flex: 0 0 25% !important;
        text-align: center !important;
    }
    
    .timeline-section .column-headers .date-column {
        flex: 0 0 25% !important;
        text-align: right !important;
        padding-right: 12px !important;
    }
    
    .timeline-section .list-group {
        margin-bottom: 0 !important;
    }
    
    .timeline-section .list-group-item {
        padding: 6px 12px !important;
        font-size: 0.8rem !important;
        border: none !important;
        border-bottom: 1px solid #f0f0f0 !important;
        margin: 0 !important;
        display: flex !important;
        align-items: center !important;
        transition: background-color 0.15s ease-in-out !important;
    }
    
    .timeline-section .list-group-item:hover {
        background-color: #f8f9fa !important;
    }
    
    .timeline-section .list-group-item:last-child {
        border-bottom: none !important;
    }
    
    .timeline-section .badge {
        flex: 0 0 25% !important;
        font-size: 0.7rem !important;
        padding: 4px 8px !important;
        border-radius: 3px !important;
        margin: 0 auto !important; /* Centralizar horizontalmente */
        text-align: center !important;
        display: inline-block !important;
        width: auto !important;
        min-width: 80px !important;
        max-width: 90px !important; /* Limitar largura máxima */
    }
    
    /* Container de status para centralizar o badge */
    .timeline-section .status-container {
        flex: 0 0 25% !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
    }
    
    /* Badge para A Fazer em cinza */
    .timeline-section .badge.bg-secondary {
        background-color: #6c757d !important;
        color: white !important;
    }
    
    .timeline-section .text-muted.small {
        flex: 0 0 25% !important;
        font-size: 0.75rem !important;
        white-space: nowrap !important;
        text-align: right !important;
        color: #6c757d !important;
        padding-right: 12px !important;
    }
    
    .timeline-task-name {
        flex: 0 0 50% !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        margin-right: 0 !important;
        font-weight: 500 !important;
        color: #495057 !important;
        text-align: left !important;
        font-size: 0.8rem !important;
    }
    
    /* Alinhar estilo da tabela de marcos */
    .table-sm th {
        font-weight: 700 !important;
        font-size: 0.7rem !important;
        background-color: #eef0f2 !important;
        color: #555 !important;
        padding: 6px 12px !important;
        border-bottom: 1px solid #dee2e6 !important;
    }
    
    .table-sm td {
        font-size: 0.8rem !important;
        padding: 6px 12px !important;
        vertical-align: middle !important;
    }
    
    /* Garantir que os ícones e textos de data fiquem lado a lado */
    .timeline-section .text-muted.small i {
        margin-right: 2px !important;
    }
    
    .timeline-section .text-muted.small span.mx-1 {
        margin-left: 3px !important;
        margin-right: 3px !important;
        opacity: 0.7 !important;
    }

    /* Alinhamento específico para a tabela de marcos */
    .table-sm th:first-child {
        text-align: left !important;
    }
    
    .table-sm th:last-child {
        text-align: right !important;
    }
    
    .table-sm td:first-child {
        text-align: left !important;
    }
    
    .table-sm td:last-child {
        text-align: right !important;
    }

    /* Garantir que os badges em ambas as seções sejam idênticos */
    .timeline-section .badge,
    .table-sm .badge {
        font-size: 0.7rem !important;
        padding: 4px 8px !important;
        border-radius: 3px !important;
        display: inline-block !important;
        text-align: center !important;
        min-width: 80px !important;
    }

    /* Ajuste para o ícone de Marco (ponto de exclamação) */
    .table-sm td .badge.bg-danger {
        font-size: 0.65rem !important;
        padding: 2px 4px !important;
        margin-right: 6px !important;
        width: auto !important;
        min-width: auto !important;
    }
    
    /* Ajuste para o badge de status de Marco */
    .table-sm td:nth-child(2) .badge {
        font-size: 0.7rem !important;
        padding: 4px 8px !important;
        border-radius: 3px !important;
        display: inline-block !important;
        text-align: center !important;
        min-width: 80px !important;
    }

    /* Estilos para a seção de notas */
    .note-section .list-group-item {
        transition: background-color 0.2s ease;
        text-align: left !important; /* Força o alinhamento do conteúdo à esquerda */
    }

    .note-section .list-group-item:hover {
        background-color: rgba(0,0,0,0.02);
    }

    .note-section .badge {
        font-size: 0.7rem;
        padding: 0.35em 0.65em;
    }

    .note-section .text-muted {
        font-size: 0.8rem;
    }

    /* Cores específicas para categorias de notas */
    .badge.bg-decision { background-color: #4e73df !important; }
    .badge.bg-impediment { background-color: #e74a3b !important; }
    .badge.bg-general { background-color: #858796 !important; }

    /* Cores específicas para prioridades */
    .badge.bg-high { background-color: #e74a3b !important; }
    .badge.bg-medium { background-color: #f6c23e !important; }
    .badge.bg-low { background-color: #1cc88a !important; }

    /* Ajustes para impressão */
    @media print {
        .note-section {
            break-inside: avoid; /* Manter */
            /* page-break-inside: avoid; */ /* Comentado */
        }
        
        .note-section .list-group-item {
            break-inside: avoid; /* Manter */
            /* page-break-inside: avoid; */ /* Comentado, pois a regra acima é mais específica e tem !important */
        }
    }

    /* Permitir quebra dentro do card da seção de notas, mas manter itens de nota juntos */
    .placeholder-section .card {
        page-break-inside: auto !important;
    }
    /* Reforçar que itens de nota individuais não quebram */
    .placeholder-section .card .note-section .list-group-item {
        page-break-inside: avoid !important; 
    }
    
    /* Permitir quebra dentro do card da seção de Riscos e Impedimentos */
    .placeholder-section:has(h6:contains("Riscos e Impedimentos")) .card {
        page-break-inside: auto !important;
    }

    /* Reforçar que itens de nota individuais NÃO quebram */
    .placeholder-section .card .note-section .list-group-item {
        page-break-inside: avoid !important; 
    }

    /* Estilos para o rodapé da empresa na impressão do navegador */
    .company-footer.pdf-only {
        /* page-break-before: auto !important; */ /* Comentado pois auto é o padrão e pode não ser necessário forçar */
        margin-top: 20px !important; /* Aumentado para mais espaço acima */
        padding-top: 10px !important; /* Aumentado para mais espaço interno acima */
        border-top: 1px solid #ddd !important; /* Adiciona uma linha sutil no topo do rodapé */
        text-align: left !important; /* Alinha todo o texto do rodapé à esquerda */
        font-size: 7pt !important; /* Define um tamanho de fonte base para o rodapé */
        color: #333 !important; /* Cor de texto principal para o rodapé */
    }

    .company-footer.pdf-only .footer-line {
        margin-bottom: 3px !important; /* Pequeno espaço entre as linhas do rodapé */
    }

    /* Garantir que o contêiner dos badges de categoria/prioridade alinhe à esquerda */
    .note-section .list-group-item > .d-flex > div:first-child {
        text-align: left !important;
    }

    /* Garantir que o contêiner das tags (Informação, Combinado) alinhe à esquerda e não tenha padding lateral */
    .note-section .list-group-item .mt-2 {
        text-align: left !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
        display: flex !important; /* Para garantir que justify-content funcione */
        justify-content: flex-start !important; /* Alinha itens flex à esquerda */
    }

    /* Remover margem direita dos badges dentro da seção de notas para alinhamento à esquerda completo */
    .note-section .list-group-item .badge.me-1,
    .note-section .list-group-item .badge.me-2, /* Caso usem me-2, etc. */
    .note-section .list-group-item .badge.m-1, /* Caso usem m-1, etc. */
    .note-section .list-group-item .badge.ms-1,
    .note-section .list-group-item .badge.ms-2 {
        margin-right: 0 !important;
        margin-left: 0 !important; /* Adicionado para garantir que não haja margem esquerda também */
    }

    .note-section .list-group-item:hover {
        background-color: rgba(0,0,0,0.02);
    }

    /* NOVO: Melhores estilos para tabela de riscos */
    .risk-description {
        font-weight: 500 !important;
        color: #495057 !important;
        text-align: left !important;
        display: inline-block !important;
        font-size: 0.9rem !important;
        line-height: 1.4 !important;
    }

</style>

{% endblock %}

{% block content %}

<div class="container-fluid">
    {% if error %}
        <div class="alert alert-danger" role="alert">
            <h4 class="alert-heading">Erro ao Gerar Status Report</h4>
            <p>{{ error }}</p>
        </div>
    {% elif report_data %}
        <div class="report-header text-center">
            <!-- Cabeçalho da Página -->
            <div class="d-sm-flex align-items-center justify-content-between mb-3">
                <h1 class="h3 mb-0 text-gray-800">
                    <i class="bi bi-file-earmark-text me-2"></i>Status Report
                </h1>
                <div class="screen-only"> <!-- Div para agrupar data e botão -->
                    <span class="text-muted small me-3">Gerado em: {{ data_geracao | default('N/A', true) }}</span>
                    <!-- Botão para o Quadro Kanban -->
                    <a href="{{ url_for('backlog.board_by_project', project_id=project_id) }}" 
                       class="btn btn-sm btn-outline-info me-2" 
                       title="Ir para o Quadro Kanban do Projeto">
                        <i class="bi bi-kanban me-1"></i> Quadro Kanban
                    </a>
                    <!-- Botões de ação - apenas o botão de impressão será visível -->
                    <button class="btn btn-sm btn-outline-secondary ms-2" onclick="window.print();" title="Usar impressão do navegador">
                        <i class="bi bi-printer me-1"></i> Imprimir
                    </button>
                    <!-- Botões ocultos por padrão -->
                    <button class="btn btn-sm btn-warning me-2 d-none" id="editModeBtn" title="Editar relatório antes de baixar">
                        <i class="bi bi-pencil-square me-1"></i> <span>Editar Relatório</span>
                    </button>
                    {% if pdf_generator_available %}
                        <a href="{{ url_for('macro.download_status_report', project_id=project_id) }}" 
                           class="btn btn-sm btn-primary" 
                           title="Baixar Relatório em PDF ({{ generator_type }})">
                            <i class="bi bi-download me-1"></i> Baixar PDF (Servidor)
                        </a>
                    {% endif %}
                    <!-- Botão para gerar PDF via JavaScript (oculto) -->
                    <button class="btn btn-sm btn-success ms-2 d-none" id="generatePdfBtn" title="Gerar PDF usando o navegador">
                        <i class="bi bi-filetype-pdf me-1"></i> Baixar PDF (Browser)
                    </button>
                </div>
            </div>

            <!-- Container principal que será convertido para PDF -->
            <div id="pdfContent">
            
            <!-- NOVO CABEÇALHO PARA IMPRESSÃO (logo, info empresa, título) -->
            <div class="print-header-layout pdf-only">
                <div class="print-logo-area">
                    <img src="{{ url_for('static', filename='images/sou.cloud.png') }}" alt="SOU.cloud Logo" class="print-logo-large">
                </div>
                <div class="company-info-area">
                    <div class="company-name">Control360.SOU - PMO</div>
                    <div class="report-date">Data: <strong>{{ data_geracao | default('N/A', true) }}</strong></div>
                </div>
                <div class="print-title-area">
                    <h1 class="print-main-title">Status Report</h1>
                </div>
            </div>
            
            <!-- Detalhes do Projeto - Mantém o original na tela, redesenhado apenas na impressão -->
            <div class="project-details-header screen-only">
                <span><strong>Projeto:</strong> <span class="editable-field" data-field="project-name">{{ report_data.info_geral.nome | default('N/A') }}</span></span>
                <span><strong>ID:</strong> <span class="editable-field" data-field="project-id">{{ report_data.info_geral.id | default('N/A') }}</span></span>
                <span><strong>Status Atual:</strong> <span class="editable-field" data-field="project-status">{{ report_data.info_geral.status_atual | default('N/A') }}</span></span>
                <span><strong>Squad:</strong> <span class="editable-field" data-field="project-squad">{{ report_data.info_geral.squad | default('N/A') }}</span></span>
                <span><strong>Especialista:</strong> <span class="editable-field" data-field="project-specialist">{{ report_data.info_geral.especialista | default('N/A') }}</span></span>
            </div>

            <!-- Versão para impressão (apenas visível no PDF) -->
            <div class="project-info-line pdf-only">
                <span class="project-info-item"><strong>Projeto:</strong> <span class="editable-field" data-field="project-name">{{ report_data.info_geral.nome | default('N/A') }}</span></span>
                <span class="project-info-separator">|</span>
                <span class="project-info-item"><strong>ID:</strong> <span class="editable-field" data-field="project-id">{{ report_data.info_geral.id | default('N/A') }}</span></span>
                <span class="project-info-separator">|</span>
                <span class="project-info-item"><strong>Status:</strong> <span class="editable-field" data-field="project-status">{{ report_data.info_geral.status_atual | default('N/A') }}</span></span>
                <span class="project-info-separator">|</span>
                <span class="project-info-item"><strong>Squad:</strong> <span class="editable-field" data-field="project-squad">{{ report_data.info_geral.squad | default('N/A') }}</span></span>
                <span class="project-info-separator">|</span>
                <span class="project-info-item"><strong>Especialista:</strong> <span class="editable-field" data-field="project-specialist">{{ report_data.info_geral.especialista | default('N/A') }}</span></span>
            </div>

            <!-- Linha de KPIs Resumo -->
            <div class="row">
                <!-- Status Geral -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-primary shadow h-100 py-2 kpi-card">
                        <div class="card-body">
                            <i class="bi bi-clipboard-data kpi-icon"></i>
                            <div class="kpi-content">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">STATUS GERAL</div>
                                {% set status_color_class = report_data.status_geral_indicador | default('cinza') %}
                                <div class="d-flex align-items-center">
                                     <span class="status-dot status-{{ status_color_class }}" data-status-dot></span>
                                     {% set status_text_map = {
                                         'verde': 'No Prazo',
                                         'amarelo': 'Atenção',
                                         'vermelho': 'Crítico',
                                         'azul': 'Concluído',
                                         'cinza': 'Não Iniciado'
                                     } %}
                                     <span class="h5 status-text text-{{ status_color_class }} editable-field" data-field="status-geral" data-status-text>{{ status_text_map.get(status_color_class, 'Não Iniciado') }}</span>
                                     <div class="status-selector ml-2" style="display:none;">
                                        <select class="form-select form-select-sm">
                                            <option value="verde">No Prazo</option>
                                            <option value="amarelo">Atenção</option>
                                            <option value="vermelho">Crítico</option>
                                            <option value="azul">Concluído</option>
                                            <option value="cinza">Não Iniciado</option>
                                        </select>
                                     </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- % Concluído -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-info shadow h-100 py-2 kpi-card">
                        <div class="card-body">
                            <i class="bi bi-check2-circle kpi-icon"></i>
                            <div class="kpi-content">
                                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">% CONCLUÍDO</div>
                                <div class="h1 mb-0 font-weight-bold text-gray-800 editable-field" data-field="percentual-concluido">{{ report_data.progresso.percentual_concluido | round(1) }}%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Status Prazo -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-warning shadow h-100 py-2 kpi-card">
                        <div class="card-body">
                            <i class="bi bi-calendar-week kpi-icon"></i>
                            <div class="kpi-content">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">STATUS DO PRAZO</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800 editable-field" data-field="status-prazo">{{ report_data.progresso.status_prazo | default('A Definir') }}</div>
                                <small class="text-muted">Prev: <span class="editable-field" data-field="data-prevista">{{ report_data.progresso.data_prevista_termino | default(report_data.info_geral.data_vencimento | default('N/A', true)) }}</span></small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- % Esforço Consumido -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-success shadow h-100 py-2 kpi-card">
                        <div class="card-body">
                            <i class="bi bi-hourglass-split kpi-icon"></i>
                            <div class="kpi-content">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">% ESFORÇO CONSUMIDO</div>
                                <div class="h1 mb-0 font-weight-bold text-gray-800 editable-field" data-field="percentual-esforco">{{ report_data.esforco.percentual_consumido | round(1) }}%</div>
                                <small class="text-muted"><span class="editable-field" data-field="horas-utilizadas">{{ report_data.esforco.horas_utilizadas | round(1) }}</span>h / <span class="editable-field" data-field="horas-planejadas">{{ report_data.esforco.horas_planejadas | round(1) }}</span>h</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Linha de Gráficos (Lado a Lado) -->
            <div class="row">
                <!-- Coluna Esquerda: Gráfico de Progresso -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow chart-card h-100">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Progresso (% Concluído)</h6>
                        </div>
                        <div class="card-body d-flex justify-content-center align-items-center">
                            <canvas id="progressoChart" style="max-height: 200px;"></canvas>
                        </div>
                    </div>
                </div>
                <!-- Coluna Direita: Gráfico de Esforço -->
                <div class="col-lg-6 mb-4">
                     <div class="card shadow chart-card h-100">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Esforço (Horas Planejado vs Utilizado)</h6>
                        </div>
                        <div class="card-body d-flex justify-content-center align-items-center">
                            <canvas id="esforcoChart" style="max-height: 200px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Marcos Recentes (Linha inteira) -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="placeholder-section">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-calendar-check text-primary me-2"></i>
                            <h6 class="section-title mb-0">Marcos Recentes</h6>
                        </div>
                        {% if report_data and report_data.marcos_recentes and report_data.marcos_recentes|length > 0 %}
                            <div class="table-responsive">
                                <table class="table table-sm table-hover">
                                    <thead>
                                        <tr class="table-light">
                                            <th style="width: 50%">Marco</th>
                                            <th style="width: 20%">Status</th>
                                            <th style="width: 30%">Data Planejada</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for marco in report_data.marcos_recentes %}
                                            <tr {% if marco.atrasado %}class="table-danger"{% endif %}>
                                                <td>
                                                    {% if marco.atrasado %}<span class="badge bg-danger me-1" title="Marco atrasado!">!</span>{% endif %}
                                                    <span class="milestone-name">{{ marco.nome | default(marco.title | default('Marco sem nome')) }}</span>
                                                </td>
                                                <td>
                                                    <span class="badge 
                                                        {% if marco.status == 'Concluído' or marco.status == 'Completed' %}bg-success
                                                        {% elif marco.status == 'Em Andamento' or marco.status == 'In Progress' %}bg-primary
                                                        {% elif marco.status == 'Atrasado' or marco.status == 'Delayed' %}bg-danger
                                                        {% else %}bg-secondary{% endif %}">
                                                        {{ marco.status | default('N/A') }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="milestone-date">{{ marco.data_planejada | default(marco.due_date | default('N/A')) }}</span>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <p class="text-muted">Nenhum marco definido para este projeto.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Linha do Tempo (Linha inteira) -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="placeholder-section">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-list-task text-primary me-2"></i>
                            <h6 class="section-title mb-0">Linha do Tempo (Tarefas)</h6>
                        </div>
                        <div class="card shadow-sm h-100">
                            {# Mostrar loading apenas se NÃO for PDF #}
                            <div id="timeline-loading" class="text-center p-3" style="display: none;">
                                <div class="spinner-border spinner-border-sm text-primary me-2" role="status"></div>
                                <span class="text-muted small">Carregando tarefas...</span>
                            </div>
                            
                            <div id="timeline-error" class="text-center p-3 text-danger" style="display: none;">
                                <i class="bi bi-exclamation-circle me-2"></i>
                                <span id="timeline-error-message" class="small">Erro ao carregar tarefas</span>
                            </div>
                            
                            <div id="timeline-empty" class="text-center p-3 text-muted" style="display: none;">
                                <i class="bi bi-info-circle me-2"></i>
                                <span class="small">Nenhuma tarefa encontrada</span>
                            </div>
                            
                            <!-- Lista de tarefas -->
                            {# Mostrar conteúdo da timeline: se for PDF, renderiza direto; senão, JS controla #}
                            <div id="timeline-content" style="display: block;">
                                <!-- Próximas tarefas -->
                                <div class="timeline-section">
                                    <div class="section-header">
                                        <i class="bi bi-calendar-event text-warning"></i>
                                        <span class="fw-bold">Próximas Tarefas (7 dias)</span>
                                    </div>
                                    {% if report_data.tarefas_proximo_prazo and report_data.tarefas_proximo_prazo|length > 0 %}
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover">
                                                <thead>
                                                    <tr class="table-light">
                                                        <th style="width: 50%">Tarefa</th>
                                                        <th style="width: 20%">Prioridade</th>
                                                        <th style="width: 30%">Prazo</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for task in report_data.tarefas_proximo_prazo %}
                                                        <tr>
                                                            <td>
                                                                <span class="timeline-task-name">{{ task.titulo | default('Tarefa sem título') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="badge bg-warning text-dark">{{ task.prioridade | default('N/A') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">{{ task.data_vencimento | default('-') }}</span>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center text-muted small p-3">Nenhuma tarefa com prazo nos próximos 7 dias.</div>
                                    {% endif %}
                                </div>
                                
                                <!-- Tarefas em andamento -->
                                <div class="timeline-section">
                                    <div class="section-header">
                                        <i class="bi bi-play-circle text-primary"></i>
                                        <span class="fw-bold">Em Andamento</span>
                                    </div>
                                    {% if report_data.tarefas_em_andamento and report_data.tarefas_em_andamento|length > 0 %}
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover">
                                                <thead>
                                                    <tr class="table-light">
                                                        <th style="width: 50%">Tarefa</th>
                                                        <th style="width: 20%">Prioridade</th>
                                                        <th style="width: 30%">Prazo</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for task in report_data.tarefas_em_andamento %}
                                                        <tr>
                                                            <td>
                                                                <span class="timeline-task-name">{{ task.titulo | default('Tarefa sem título') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="badge bg-primary">{{ task.prioridade | default('N/A')}}</span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">{{ task.data_vencimento | default('-') }}</span>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center text-muted small p-3">Nenhuma tarefa em andamento.</div>
                                    {% endif %}
                                </div>
                                
                                <!-- NOVA SEÇÃO: Tarefas em Revisão -->
                                <div class="timeline-section">
                                    <div class="section-header">
                                        <i class="bi bi-search text-info"></i>
                                        <span class="fw-bold">Em Revisão</span>
                                    </div>
                                    {% if report_data.tarefas_em_revisao and report_data.tarefas_em_revisao|length > 0 %}
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover">
                                                <thead>
                                                    <tr class="table-light">
                                                        <th style="width: 50%">Tarefa</th>
                                                        <th style="width: 20%">Prioridade</th>
                                                        <th style="width: 30%">Prazo</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for task in report_data.tarefas_em_revisao %}
                                                        <tr>
                                                            <td>
                                                                <span class="timeline-task-name">{{ task.titulo | default('Tarefa sem título') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="badge bg-info">{{ task.prioridade | default('N/A') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">{{ task.data_vencimento | default('-') }}</span>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center text-muted small p-3">Nenhuma tarefa em revisão.</div>
                                    {% endif %}
                                </div>
                                
                                <!-- NOVA SEÇÃO: Tarefas Pendentes -->
                                <div class="timeline-section">
                                    <div class="section-header">
                                        <i class="bi bi-pause-circle text-secondary"></i>
                                        <span class="fw-bold">Pendente</span>
                                    </div>
                                    {% if report_data.tarefas_pendentes and report_data.tarefas_pendentes|length > 0 %}
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover">
                                                <thead>
                                                    <tr class="table-light">
                                                        <th style="width: 50%">Tarefa</th>
                                                        <th style="width: 20%">Prioridade</th>
                                                        <th style="width: 30%">Prazo</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for task in report_data.tarefas_pendentes %}
                                                        <tr>
                                                            <td>
                                                                <span class="timeline-task-name">{{ task.titulo | default('Tarefa sem título') }}</span>
                                                            </td>
                                                            <td>
                                                                {% set priority_class = 'bg-secondary' %}
                                                                {% if task.prioridade == 'Alta' %} {% set priority_class = 'bg-warning text-dark' %}
                                                                {% elif task.prioridade == 'Urgente' %} {% set priority_class = 'bg-danger' %}
                                                                {% elif task.prioridade == 'Média' %} {% set priority_class = 'bg-info' %}
                                                                {% elif task.prioridade == 'Baixa' %} {% set priority_class = 'bg-success' %}{% endif %}
                                                                <span class="badge {{ priority_class }}">{{ task.prioridade | default('N/A')}}</span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">{{ task.data_vencimento | default('-') }}</span>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center text-muted small p-3">Nenhuma tarefa pendente.</div>
                                    {% endif %}
                                </div>
                                
                                <!-- Tarefas concluídas -->
                                <div class="timeline-section">
                                    <div class="section-header">
                                        <i class="bi bi-check-circle text-success"></i>
                                        <span class="fw-bold">Concluídas</span>
                                    </div>
                                    {% if report_data.tarefas_concluidas and report_data.tarefas_concluidas|length > 0 %}
                                        <div class="table-responsive">
                                            <table class="table table-sm table-hover">
                                                <thead>
                                                    <tr class="table-light">
                                                        <th style="width: 50%">Tarefa</th>
                                                        <th style="width: 20%">Prioridade</th>
                                                        <th style="width: 30%">Prazo/Conclusão</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for task in report_data.tarefas_concluidas %}
                                                        <tr>
                                                            <td>
                                                                <span class="timeline-task-name">{{ task.titulo | default('Tarefa sem título') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="badge bg-success">{{ task.prioridade | default('N/A') }}</span>
                                                            </td>
                                                            <td>
                                                                <span class="text-muted small">{{ task.data_vencimento | default('-') }}</span>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="text-center text-muted small p-3">Nenhuma tarefa concluída.</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Riscos e Impedimentos (Linha inteira) -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="placeholder-section">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-exclamation-triangle text-danger me-2"></i>
                            <h6 class="section-title mb-0">Riscos e Impedimentos</h6>
                        </div>
                        {% if report_data and report_data.riscos_impedimentos and report_data.riscos_impedimentos|length > 0 %}
                            <div class="table-responsive">
                                <table class="table table-sm table-hover">
                                    <thead>
                                        <tr class="table-light">
                                            <th style="width: 50%">Descrição do Risco</th>
                                            <th style="width: 20%">Severidade</th>
                                            <th style="width: 30%">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for risco in report_data.riscos_impedimentos %}
                                            <tr>
                                                <td>
                                                    <span class="risk-description">{{ risco.descricao | default('Sem descrição') }}</span>
                                                </td>
                                                <td>
                                                    <span class="badge 
                                                        {% if risco.severidade == 'Crítico' or risco.severidade == 'Critico' %}bg-danger
                                                        {% elif risco.severidade == 'Alto' or risco.severidade == 'Alta' %}bg-danger
                                                        {% elif risco.severidade == 'Médio' or risco.severidade == 'Medio' or risco.severidade == 'Média' %}bg-warning text-dark
                                                        {% elif risco.severidade == 'Baixo' or risco.severidade == 'Baixa' %}bg-success
                                                        {% else %}bg-secondary{% endif %}">
                                                        {{ risco.severidade | default('N/A') }}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="badge 
                                                        {% if risco.status == 'Ativo' %}bg-warning text-dark
                                                        {% elif risco.status == 'Resolvido' %}bg-success
                                                        {% elif risco.status == 'Mitigado' %}bg-info
                                                        {% elif risco.status == 'Em Monitoramento' %}bg-info
                                                        {% else %}bg-secondary{% endif %}">
                                                        {{ risco.status | default('N/A') }}
                                                    </span>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <p class="text-muted">Nenhum risco ou impedimento identificado para este projeto.</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Notas e Observações (Linha inteira) -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="placeholder-section">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-journal-text text-info me-2"></i>
                            <h6 class="section-title mb-0">Notas e Observações</h6>
                        </div>
                        {% if report_data and report_data.notas and report_data.notas|length > 0 %}
                            <div class="card">
                                <div class="list-group list-group-flush note-section">
                                    {% for nota in report_data.notas %}
                                        <div class="list-group-item">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div class="flex-grow-1">
                                                    <div class="mb-2">
                                                        <span class="badge 
                                                            {% if nota.categoria == 'decision' %}bg-primary
                                                            {% elif nota.categoria == 'impediment' %}bg-danger
                                                            {% elif nota.categoria == 'general' %}bg-secondary
                                                            {% else %}bg-info{% endif %} me-1">
                                                            {% if nota.categoria == 'decision' %}Decisão
                                                            {% elif nota.categoria == 'impediment' %}Impedimento
                                                            {% elif nota.categoria == 'general' %}Geral
                                                            {% else %}{{ nota.categoria | title }}{% endif %}
                                                        </span>
                                                        {% if nota.prioridade %}
                                                            <span class="badge 
                                                                {% if nota.prioridade == 'Alta' %}bg-danger
                                                                {% elif nota.prioridade == 'Média' %}bg-warning text-dark
                                                                {% elif nota.prioridade == 'Baixa' %}bg-success
                                                                {% else %}bg-secondary{% endif %} me-1">
                                                                {{ nota.prioridade }}
                                                            </span>
                                                        {% endif %}
                                                    </div>
                                                    <p class="mb-1">{{ nota.conteudo | default('Nota sem conteúdo') }}</p>
                                                    {% if nota.data_criacao %}
                                                        <small class="text-muted">{{ nota.data_criacao }}</small>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% else %}
                            <p class="text-muted">Nenhuma nota ou observação registrada para este projeto.</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Próximos Passos (Linha inteira) - COMENTADO PARA IMPLEMENTAÇÃO FUTURA -->
            <!--
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="placeholder-section">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-arrow-right-circle text-success me-2"></i>
                            <h6 class="section-title mb-0">Próximos Passos</h6>
                        </div>
                        {% if report_data and report_data.proximos_passos and report_data.proximos_passos|length > 0 %}
                            <div class="card">
                                <div class="list-group list-group-flush">
                                    {% for passo in report_data.proximos_passos %}
                                        <div class="list-group-item">
                                            <div class="d-flex align-items-start">
                                                <i class="bi bi-arrow-right text-primary me-2 mt-1"></i>
                                                <div class="flex-grow-1">
                                                    <h6 class="mb-1">{{ passo.titulo | default('Passo sem título') }}</h6>
                                                    {% if passo.descricao %}
                                                        <p class="mb-1">{{ passo.descricao }}</p>
                                                    {% endif %}
                                                    {% if passo.prazo %}
                                                        <small class="text-muted">
                                                            <i class="bi bi-calendar me-1"></i>Prazo: {{ passo.prazo }}
                                                        </small>
                                                    {% endif %}
                                                    {% if passo.responsavel %}
                                                        <small class="text-muted ms-3">
                                                            <i class="bi bi-person me-1"></i>{{ passo.responsavel }}
                                                        </small>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% else %}
                            <p class="text-muted">Nenhum próximo passo definido para este projeto.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            -->

            <!-- Rodapé da empresa (apenas para PDF) -->
            <div class="company-footer pdf-only">
                <div class="footer-line"><strong>Control360.SOU - Project Management Office</strong></div>
                <div class="footer-line">Relatório gerado automaticamente pelo sistema PMO</div>
                <div class="footer-line">Data: {{ data_geracao | default('N/A', true) }}</div>
            </div>

            </div> <!-- Fim do pdfContent -->
        </div>
    {% else %}
        <p>Nenhum dado de relatório disponível.</p>
    {% endif %}
</div>

<script>
// Função para carregar dados das tarefas quando não é PDF
document.addEventListener('DOMContentLoaded', function() {
    console.log('Status Report - DOM carregado');
    
    // Verificar se não é visualização PDF
    const isForPdf = {{ 'true' if for_pdf else 'false' }};
    
    if (!isForPdf) {
        console.log('Modo não-PDF detectado, mostrando conteúdo das tarefas...');
        
        // Ocultar loading e mostrar conteúdo
        const timelineLoading = document.getElementById('timeline-loading');
        const timelineContent = document.getElementById('timeline-content');
        
        if (timelineLoading) {
            timelineLoading.style.display = 'none';
        }
        
        if (timelineContent) {
            timelineContent.style.display = 'block';
        }
        
        console.log('Timeline content exibido com sucesso');
    }
    
    // Carregar gráficos
    initCharts();
});

function initCharts() {
    // Dados do relatório
    const reportData = {
        progresso: {
            percentual_concluido: {{ report_data.progresso.percentual_concluido | default(0) | round(1) }},
        },
        esforco: {
            horas_utilizadas: {{ report_data.esforco.horas_utilizadas | default(0) | round(1) }},
            horas_planejadas: {{ report_data.esforco.horas_planejadas | default(0) | round(1) }},
            percentual_consumido: {{ report_data.esforco.percentual_consumido | default(0) | round(1) }}
        }
    };
    
    console.log('Dados para gráficos:', reportData);
    
    // Gráfico de Progresso (Doughnut)
    const progressoCtx = document.getElementById('progressoChart');
    if (progressoCtx) {
        const percentualConcluido = reportData.progresso.percentual_concluido;
        const percentualRestante = 100 - percentualConcluido;
        
        new Chart(progressoCtx, {
            type: 'doughnut',
            data: {
                labels: ['Concluído', 'Restante'],
                datasets: [{
                    data: [percentualConcluido, percentualRestante],
                    backgroundColor: [
                        '#1cc88a', // Verde para concluído
                        '#e3e6f0'  // Cinza para restante
                    ],
                    borderWidth: 2,
                    borderColor: '#ffffff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '60%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + '%';
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Gráfico de Esforço (Bar)
    const esforcoCtx = document.getElementById('esforcoChart');
    if (esforcoCtx) {
        const horasUtilizadas = reportData.esforco.horas_utilizadas;
        const horasPlanejadas = reportData.esforco.horas_planejadas;
        const horasRestantes = Math.max(0, horasPlanejadas - horasUtilizadas);
        
        new Chart(esforcoCtx, {
            type: 'bar',
            data: {
                labels: ['Horas'],
                datasets: [
                    {
                        label: 'Utilizadas',
                        data: [horasUtilizadas],
                        backgroundColor: '#4e73df',
                        borderColor: '#4e73df',
                        borderWidth: 1
                    },
                    {
                        label: 'Restantes',
                        data: [horasRestantes],
                        backgroundColor: '#e3e6f0',
                        borderColor: '#e3e6f0',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: true,
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        stacked: true,
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value + 'h';
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.y + 'h';
                            }
                        }
                    }
                }
            }
        });
    }
}
</script>

<!-- Carregar Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}