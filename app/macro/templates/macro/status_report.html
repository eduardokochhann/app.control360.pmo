<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ titulo_pagina if titulo_pagina else 'Status Report' }}</title>
    <!-- Incluir CSS básico (ex: Bootstrap ou customizado) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .report-header { margin-bottom: 30px; padding-bottom: 15px; border-bottom: 2px solid #dee2e6; }
        .section-title { margin-top: 20px; margin-bottom: 10px; font-weight: bold; font-size: 1.2em; color: #0056b3; }
        .card-kpi { margin-bottom: 15px; }
        .placeholder { color: #999; font-style: italic; }
        .status-dot { height: 20px; width: 20px; border-radius: 50%; display: inline-block; vertical-align: middle; margin-right: 5px; }
        .status-verde { background-color: #28a745; }
        .status-amarelo { background-color: #ffc107; }
        .status-vermelho { background-color: #dc3545; }
        .status-cinza { background-color: #6c757d; }
        
        /* Timeline moderna com alinhamento aprimorado */
        .timeline-section {
            margin-bottom: 0 !important;
        }

        .timeline-section .section-header {
            padding: 3px 10px !important;
            margin: 0 !important;
            background-color: #f8f9fa !important;
            border-bottom: 1px solid #e9ecef !important;
        }

        .timeline-section .list-group {
            margin-bottom: 0 !important;
        }

        .timeline-section .list-group-item {
            padding: 4px 10px !important;
            font-size: 0.75rem !important;
            border: none !important;
            border-bottom: 1px solid #f0f0f0 !important;
            margin: 0 !important;
            display: flex !important;
            align-items: center !important;
            transition: background-color 0.15s ease-in-out !important;
        }

        .timeline-section .list-group-item:hover {
            background-color: #f8f9fa !important;
        }

        .timeline-section .list-group-item:last-child {
            border-bottom: none !important;
        }

        .timeline-section .badge {
            font-size: 0.65rem !important;
            padding: 2px 6px !important;
            border-radius: 3px !important;
            margin: 0 8px !important;
            flex-shrink: 0 !important;
        }

        .timeline-section .text-muted.small {
            font-size: 0.65rem !important;
            white-space: nowrap !important;
            flex-shrink: 0 !important;
            margin-left: auto !important;
            display: flex !important;
            align-items: center !important;
            color: #6c757d !important;
        }

        /* Título da tarefa em destaque */
        .timeline-task-name {
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            margin-right: 0 !important;
            font-weight: 500 !important;
            color: #495057 !important;
            flex-grow: 1 !important;
            max-width: 55% !important;
        }

        /* Garantir que os ícones e textos de data fiquem lado a lado */
        .timeline-section .text-muted.small i {
            margin-right: 2px !important;
        }

        .timeline-section .text-muted.small span.mx-1 {
            margin-left: 3px !important;
            margin-right: 3px !important;
            opacity: 0.7 !important;
        }
    </style>
</head>
<body>

<!-- Seção de Depuração MOVIDA PARA CIMA E FORA DA CONDIÇÃO -->
<div class="debug-box mb-4 p-3 border border-danger bg-light">\
    <h4>DEBUG MARCOS RECENTES (MOVIDO)</h4>\
    <pre class="border bg-white p-2 mt-1">{{ report_data.marcos_recentes|tojson if report_data is defined and report_data.marcos_recentes is defined else "report_data.marcos_recentes NÃO DEFINIDO OU VAZIO" }}</pre>\
</div>

<div class="container">
    {% if error %}
        <div class="alert alert-danger" role="alert">
            <h4>Erro ao Gerar Status Report</h4>
            <p>{{ error }}</p>
        </div>
    {% elif report_data %}
        <!-- Seção de Depuração ORIGINAL (Pode ser removida depois se a de cima funcionar) -->
        <div class="debug-box mb-4 p-3 border border-info bg-light">\
            <h4>Informações de Debug</h4>
            <div>\
                <strong>Report Data existe?</strong> {{ report_data is defined and report_data is not none }}\
            </div>
            <div>\
                <strong>report_data.marcos_recentes existe?</strong> {{ report_data.marcos_recentes is defined if report_data is defined else "N/A" }}\
            </div>
            <div>\
                <strong>report_data.marcos_recentes é lista?</strong> {{ report_data.marcos_recentes is sequence if report_data is defined and report_data.marcos_recentes is defined else "N/A" }}\
            </div>
            <div>\
                <strong>Tamanho de marcos_recentes:</strong> {{ report_data.marcos_recentes|length if report_data is defined and report_data.marcos_recentes is defined else "N/A" }}\
            </div>
            \
            <!-- Exibição dos marcos em formato JSON -->\
            <div class="mt-2">\
                <strong>Marcos (JSON):</strong>\
                <pre class="border bg-white p-2 mt-1">{{ report_data.marcos_recentes|tojson if report_data is defined and report_data.marcos_recentes is defined else "N/A" }}</pre>\
            </div>\
        </div>
        
        <div class="report-header text-center">
            <h2>Status Report - Projeto {{ report_data.info_geral.nome | default(project_id, true) }}</h2>
            <p class="text-muted">Gerado em: {{ data_geracao | default('N/A', true) }}</p>
            <!-- <p>Período: [TODO: Definir Período]</p> -->
        </div>

        <!-- Resumo -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card card-kpi">
                    <div class="card-body text-center">
                        <h5 class="card-title">Status Geral</h5>
                        {% set status_color = report_data.status_geral_indicador | default('cinza') %}
                        <span class="status-dot status-{{ status_color }}"></span>
                        <span class="fw-bold text-{{ status_color }}">{{ status_color | capitalize | default('A Definir') }}</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card card-kpi">
                    <div class="card-body text-center">
                        <h5 class="card-title">% Concluído</h5>
                        <p class="card-text fs-4 fw-bold">{{ report_data.progresso.percentual_concluido | round(1) }}%</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card card-kpi">
                    <div class="card-body text-center">
                        <h5 class="card-title">Prazo</h5>
                        <p class="card-text">{{ report_data.progresso.data_prevista_termino | default('N/A', true) }}</p>
                        <span class="badge bg-secondary">{{ report_data.progresso.status_prazo | default('A Definir') }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção de Detalhes -->
        <div class="row">
            <div class="col-md-6">
                <h4 class="section-title">Detalhes do Projeto</h4>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>ID:</strong> {{ report_data.info_geral.id | default('N/A') }}</li>
                    <li class="list-group-item"><strong>Nome:</strong> {{ report_data.info_geral.nome | default('N/A') }}</li>
                    <li class="list-group-item"><strong>Status Atual:</strong> {{ report_data.info_geral.status_atual | default('N/A') }}</li>
                    <li class="list-group-item"><strong>Squad:</strong> {{ report_data.info_geral.squad | default('N/A') }}</li>
                    <li class="list-group-item"><strong>Especialista:</strong> {{ report_data.info_geral.especialista | default('N/A') }}</li>
                </ul>

                <h4 class="section-title">Esforço (Horas)</h4>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>Planejado:</strong> {{ report_data.esforco.horas_planejadas | round(1) }}h</li>
                    <li class="list-group-item"><strong>Utilizado:</strong> {{ report_data.esforco.horas_utilizadas | round(1) }}h</li>
                    <li class="list-group-item"><strong>Consumido:</strong> {{ report_data.esforco.percentual_consumido | round(1) }}%</li>
                </ul>
                <!-- TODO: Adicionar gráfico de esforço -->

            </div>
            <div class="col-md-6">
                <h4 class="section-title">Marcos Recentes</h4>
                {% include 'macro/includes/report_marcos.html' %}

                <h4 class="section-title">Riscos e Impedimentos</h4>
                {% if report_data.riscos_impedimentos and report_data.riscos_impedimentos|length > 0 %}
                    <div class="table-responsive">
                        <table class="table table-sm table-hover table-striped mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Descrição</th>
                                    <th class="text-center">Severidade</th>
                                    <th class="text-center">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for risco in report_data.riscos_impedimentos %}
                                    <tr>
                                        <td style="white-space: pre-wrap; word-break: break-word; font-size: 0.75rem;">{{ risco.description }}</td>
                                        <td class="text-center">
                                            {% set severity_class = 'badge bg-secondary' %}
                                            {% if risco.severity == 'Crítico' %}
                                                {% set severity_class = 'badge bg-danger' %}
                                            {% elif risco.severity == 'Alto' %}
                                                {% set severity_class = 'badge bg-warning text-dark' %}
                                            {% elif risco.severity == 'Médio' %}
                                                {% set severity_class = 'badge bg-info text-dark' %}
                                            {% elif risco.severity == 'Baixo' %}
                                                {% set severity_class = 'badge bg-secondary' %}
                                            {% endif %}
                                            <span class="{{ severity_class }}" style="font-size: 0.65rem;">{{ risco.severity }}</span>
                                        </td>
                                        <td class="text-center">
                                            {% set status_class = 'badge bg-secondary' %}
                                            {% if risco.status == 'Ativo' %}
                                                {% set status_class = 'badge bg-warning text-dark' %}
                                            {% elif risco.status == 'Mitigado' %}
                                                {% set status_class = 'badge bg-info text-dark' %}
                                            {% elif risco.status == 'Resolvido' %}
                                                {% set status_class = 'badge bg-success' %}
                                            {% endif %}
                                            <span class="{{ status_class }}" style="font-size: 0.65rem;">{{ risco.status }}</span>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center p-3 text-muted small">
                        <i class="bi bi-info-circle me-1"></i>Nenhum risco ativo.
                    </div>
                {% endif %}

                <h4 class="section-title">Próximos Passos</h4>
                 <p class="placeholder">[Placeholder para Próximos Passos]</p>
                <!-- <ul class="list-group list-group-flush">
                    {% for passo in report_data.proximos_passos %}
                        <li class="list-group-item">{{ passo.descricao }}</li>
                    {% else %}
                        <li class="list-group-item placeholder">Nenhum próximo passo definido.</li>
                    {% endfor %}
                </ul> -->
            </div>
        </div>

        <!-- Seção de cards informativos -->
        <div class="row mt-4">
            <div class="col-md-4 mb-3">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-light">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-calendar-check"></i>
                            Marcos Recentes
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        {% if report_data and report_data.marcos_recentes and report_data.marcos_recentes|length > 0 %}
                            <div class="table-responsive">
                                <table class="table table-sm table-striped mb-0">
                                    <thead>
                                        <tr class="table-light">
                                            <th>Marco</th>
                                            <th>Data</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for marco in report_data.marcos_recentes %}
                                            <tr>
                                                <td class="text-start">
                                                    {% if marco.atrasado %}<span class="badge bg-danger me-1">!</span>{% endif %}
                                                    <strong>{{ marco.nome }}</strong>
                                                </td>
                                                <td>{{ marco.data_planejada }}</td>
                                                <td>
                                                    <span class="badge {% if marco.status == 'Concluído' %}bg-success{% elif marco.status == 'Em Andamento' %}bg-warning text-dark{% elif marco.status == 'Atrasado' %}bg-danger{% else %}bg-secondary{% endif %}">
                                                        {{ marco.status }}
                                                    </span>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center p-3 text-muted">
                                Nenhum marco definido para este projeto.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Card de Linha do Tempo (Tarefas) -->
            <div class="col-md-4 mb-3">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-light">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-clock"></i>
                            Linha do Tempo (Tarefas)
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <!-- Timeline de tarefas -->
                        <div id="timeline-loading" class="text-center p-3">
                            <div class="spinner-border spinner-border-sm text-primary me-2" role="status"></div>
                            <span class="text-muted small">Carregando tarefas...</span>
                        </div>
                        
                        <div id="timeline-error" class="text-center p-3 text-danger" style="display: none;">
                            <i class="bi bi-exclamation-circle me-2"></i>
                            <span id="timeline-error-message" class="small">Erro ao carregar tarefas</span>
                        </div>
                        
                        <div id="timeline-empty" class="text-center p-3 text-muted" style="display: none;">
                            <i class="bi bi-info-circle me-2"></i>
                            <span class="small">Nenhuma tarefa encontrada</span>
                        </div>
                        
                        <!-- Lista de tarefas -->
                        <div id="timeline-content" style="display: none;">
                            <!-- Próximas tarefas -->
                            <div class="timeline-section">
                                <div class="section-header bg-light p-2 border-bottom">
                                    <i class="bi bi-calendar-event text-warning"></i>
                                    <span class="ms-2 fw-bold">Próximas Tarefas</span>
                                </div>
                                <ul class="list-group list-group-flush" id="upcoming-tasks-list"></ul>
                            </div>
                            
                            <!-- Tarefas em andamento -->
                            <div class="timeline-section">
                                <div class="section-header bg-light p-2 border-bottom">
                                    <i class="bi bi-play-circle text-primary"></i>
                                    <span class="ms-2 fw-bold">Em Andamento</span>
                                </div>
                                <ul class="list-group list-group-flush" id="started-tasks-list"></ul>
                            </div>
                            
                            <!-- Tarefas concluídas -->
                            <div class="timeline-section">
                                <div class="section-header bg-light p-2 border-bottom">
                                    <i class="bi bi-check-circle text-success"></i>
                                    <span class="ms-2 fw-bold">Concluídas</span>
                                </div>
                                <ul class="list-group list-group-flush" id="completed-tasks-list"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Card de Riscos e Impedimentos -->
            <div class="col-md-4 mb-3">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-light">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-exclamation-triangle"></i>
                            Riscos e Impedimentos
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        {% if report_data.riscos_impedimentos and report_data.riscos_impedimentos|length > 0 %}
                            <div class="table-responsive">
                                <table class="table table-sm table-hover table-striped mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Descrição</th>
                                            <th class="text-center">Severidade</th>
                                            <th class="text-center">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for risco in report_data.riscos_impedimentos %}
                                            <tr>
                                                <td style="white-space: pre-wrap; word-break: break-word; font-size: 0.75rem;">{{ risco.description }}</td>
                                                <td class="text-center">
                                                    {% set severity_class = 'badge bg-secondary' %}
                                                    {% if risco.severity == 'Crítico' %}
                                                        {% set severity_class = 'badge bg-danger' %}
                                                    {% elif risco.severity == 'Alto' %}
                                                        {% set severity_class = 'badge bg-warning text-dark' %}
                                                    {% elif risco.severity == 'Médio' %}
                                                        {% set severity_class = 'badge bg-info text-dark' %}
                                                    {% elif risco.severity == 'Baixo' %}
                                                        {% set severity_class = 'badge bg-secondary' %}
                                                    {% endif %}
                                                    <span class="{{ severity_class }}" style="font-size: 0.65rem;">{{ risco.severity }}</span>
                                                </td>
                                                <td class="text-center">
                                                    {% set status_class = 'badge bg-secondary' %}
                                                    {% if risco.status == 'Ativo' %}
                                                        {% set status_class = 'badge bg-warning text-dark' %}
                                                    {% elif risco.status == 'Mitigado' %}
                                                        {% set status_class = 'badge bg-info text-dark' %}
                                                    {% elif risco.status == 'Resolvido' %}
                                                        {% set status_class = 'badge bg-success' %}
                                                    {% endif %}
                                                    <span class="{{ status_class }}" style="font-size: 0.65rem;">{{ risco.status }}</span>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center p-3 text-muted small">
                                <i class="bi bi-info-circle me-1"></i>Nenhum risco ativo.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- TODO: Adicionar gráficos -->

    {% else %}
         <div class="alert alert-warning" role="alert">
            Não foi possível carregar os dados para o Status Report do projeto ID {{ project_id }}.
        </div>
    {% endif %}

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Script customizado para status report -->
<script>
    // Expõe os dados dos marcos para o script
    window.reportData = {
        marcos_recentes: {{ report_data.marcos_recentes|tojson if report_data and report_data.marcos_recentes else '[]' }}
    };
</script>
<script src="/macro/static/js/status_report.js"></script>
<!-- Fim dos scripts -->

<!-- Adicionar scripts extras (Font Awesome e nosso código JS) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous"></script>
<script>
// Formatação de data
function formatDateString(dateStr) {
    if (!dateStr) return "-";
    try {
        const date = new Date(dateStr);
        if (isNaN(date.getTime())) return dateStr; // Retorna a string original se a data for inválida
        return date.toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit', year: 'numeric'});
    } catch (e) {
        console.error("Erro ao formatar data:", e, dateStr);
        return dateStr;
    }
}

// Escapa HTML para tooltips seguros
function escapeHtml(unsafe) {
    if (!unsafe) return '';
    return unsafe
        .toString()
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

// Função para carregar a timeline de tarefas
document.addEventListener('DOMContentLoaded', function() {
    // Elementos DOM para manipulação
    const loadingElement = document.getElementById('timeline-loading');
    const errorElement = document.getElementById('timeline-error');
    const errorMessageElement = document.getElementById('timeline-error-message');
    const emptyElement = document.getElementById('timeline-empty');
    const contentElement = document.getElementById('timeline-content');
    
    // Listas para as tarefas
    const upcomingTasksList = document.getElementById('upcoming-tasks-list');
    const startedTasksList = document.getElementById('started-tasks-list');
    const completedTasksList = document.getElementById('completed-tasks-list');
    
    // Verifica se os elementos existem
    if (!loadingElement || !errorElement || !emptyElement || !contentElement ||
        !upcomingTasksList || !startedTasksList || !completedTasksList) {
        console.error("Elementos da linha do tempo não encontrados");
        return;
    }
    
    // Função para mostrar/ocultar elementos de status
    function setTimelineStatus(isLoading, hasError, errorMsg, isEmpty) {
        loadingElement.style.display = isLoading ? 'block' : 'none';
        errorElement.style.display = hasError ? 'block' : 'none';
        if (errorMsg) errorMessageElement.textContent = errorMsg;
        emptyElement.style.display = isEmpty ? 'block' : 'none';
        contentElement.style.display = (!isLoading && !hasError && !isEmpty) ? 'block' : 'none';
    }
    
    // Busca o ID do projeto da página
    const projectId = "{{ project_id }}";
    if (!projectId) {
        setTimelineStatus(false, true, "ID do projeto não definido", false);
        return;
    }
    
    // Busca o backlog do projeto
    console.log("Buscando backlog para projeto", projectId);
    fetch(`/backlog/api/projects/${projectId}/backlog`)
        .then(response => {
            if (!response.ok) {
                if (response.status === 404) {
                    throw new Error("Nenhum backlog encontrado para este projeto");
                }
                throw new Error(`Erro ao buscar backlog: ${response.status}`);
            }
            return response.json();
        })
        .then(backlogData => {
            const backlogId = backlogData.id;
            console.log("Backlog encontrado:", backlogId);
            
            // Agora busca as tarefas da timeline
            return fetch(`/backlog/api/backlogs/${backlogId}/timeline-tasks`);
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`Erro ao carregar tarefas: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log("Dados da timeline recebidos:", data);
            
            // Verifica se há tarefas para exibir
            const hasUpcoming = data.upcoming_tasks && data.upcoming_tasks.length > 0;
            const hasStarted = data.recently_started && data.recently_started.length > 0;
            const hasCompleted = data.recently_completed && data.recently_completed.length > 0;
            
            if (!hasUpcoming && !hasStarted && !hasCompleted) {
                setTimelineStatus(false, false, null, true);
                return;
            }
            
            // Renderiza tarefas futuras
            if (hasUpcoming) {
                let html = '';
                data.upcoming_tasks.forEach(task => {
                    const startDate = task.start_date ? formatDateString(task.start_date) : '-';
                    const dueDate = task.due_date ? formatDateString(task.due_date) : '-';
                    
                    html += `
                        <li class="list-group-item" title="${escapeHtml(task.description || '')}">
                            <span class="timeline-task-name">${escapeHtml(task.title)}</span>
                            <span class="badge bg-light text-dark">A Fazer</span>
                            <span class="text-muted small">
                                <i class="bi bi-calendar-date text-primary" title="Data de Início"></i> ${startDate}
                                <span class="mx-1">→</span>
                                <i class="bi bi-calendar-check text-success" title="Prazo"></i> ${dueDate}
                            </span>
                        </li>
                    `;
                });
                upcomingTasksList.innerHTML = html || '<li class="list-group-item text-center text-muted small">Nenhuma tarefa futura</li>';
            } else {
                upcomingTasksList.innerHTML = '<li class="list-group-item text-center text-muted small">Nenhuma tarefa futura</li>';
            }
            
            // Renderiza tarefas em andamento
            if (hasStarted) {
                let html = '';
                data.recently_started.forEach(task => {
                    const startDate = task.start_date ? formatDateString(task.start_date) : '-';
                    const dueDate = task.due_date ? formatDateString(task.due_date) : '-';
                    
                    html += `
                        <li class="list-group-item" title="${escapeHtml(task.description || '')}">
                            <span class="timeline-task-name">${escapeHtml(task.title)}</span>
                            <span class="badge bg-primary">Em Andamento</span>
                            <span class="text-muted small">
                                <i class="bi bi-play-circle text-primary" title="Iniciado em"></i> ${startDate}
                                <span class="mx-1">→</span>
                                <i class="bi bi-calendar-check text-success" title="Prazo"></i> ${dueDate}
                            </span>
                        </li>
                    `;
                });
                startedTasksList.innerHTML = html || '<li class="list-group-item text-center text-muted small">Nenhuma tarefa em andamento</li>';
            } else {
                startedTasksList.innerHTML = '<li class="list-group-item text-center text-muted small">Nenhuma tarefa em andamento</li>';
            }
            
            // Renderiza tarefas concluídas
            if (hasCompleted) {
                let html = '';
                data.recently_completed.forEach(task => {
                    const completedDate = task.completed_at ? formatDateString(task.completed_at) : '-';
                    
                    html += `
                        <li class="list-group-item" title="${escapeHtml(task.description || '')}">
                            <span class="timeline-task-name">${escapeHtml(task.title)}</span>
                            <span class="badge bg-success">Concluído</span>
                            <span class="text-muted small">
                                <i class="bi bi-check-circle text-success" title="Concluído em"></i> ${completedDate}
                            </span>
                        </li>
                    `;
                });
                completedTasksList.innerHTML = html || '<li class="list-group-item text-center text-muted small">Nenhuma tarefa concluída</li>';
            } else {
                completedTasksList.innerHTML = '<li class="list-group-item text-center text-muted small">Nenhuma tarefa concluída</li>';
            }
            
            // Mostra o conteúdo
            setTimelineStatus(false, false, null, false);
        })
        .catch(error => {
            console.error("Erro ao carregar timeline:", error);
            setTimelineStatus(false, true, error.message, false);
        });
});
</script>

</body>
</html> 