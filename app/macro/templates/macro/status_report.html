<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ titulo_pagina if titulo_pagina else 'Status Report' }}</title>
    <!-- Incluir CSS básico (ex: Bootstrap ou customizado) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .report-header { margin-bottom: 30px; padding-bottom: 15px; border-bottom: 2px solid #dee2e6; }
        .section-title { margin-top: 20px; margin-bottom: 10px; font-weight: bold; font-size: 1.2em; color: #0056b3; }
        .card-kpi { margin-bottom: 15px; }
        .placeholder { color: #999; font-style: italic; }
        .status-dot { height: 20px; width: 20px; border-radius: 50%; display: inline-block; vertical-align: middle; margin-right: 5px; }
        .status-verde { background-color: #28a745; }
        .status-amarelo { background-color: #ffc107; }
        .status-vermelho { background-color: #dc3545; }
        .status-cinza { background-color: #6c757d; }
    </style>
</head>
<body>

<div class="container">
    {% if error %}
        <div class="alert alert-danger" role="alert">
            <h4>Erro ao Gerar Status Report</h4>
            <p>{{ error }}</p>
        </div>
    {% elif report_data %}
        <!-- Seção de Depuração -->
        <div class="debug-box mb-4 p-3 border border-info bg-light">
            <h4>Informações de Debug</h4>
            <div>
                <strong>Report Data existe?</strong> {{ report_data is defined and report_data is not none }}
            </div>
            <div>
                <strong>report_data.marcos_recentes existe?</strong> {{ report_data.marcos_recentes is defined if report_data is defined else "N/A" }}
            </div>
            <div>
                <strong>report_data.marcos_recentes é lista?</strong> {{ report_data.marcos_recentes is sequence if report_data is defined and report_data.marcos_recentes is defined else "N/A" }}
            </div>
            <div>
                <strong>Tamanho de marcos_recentes:</strong> {{ report_data.marcos_recentes|length if report_data is defined and report_data.marcos_recentes is defined else "N/A" }}
            </div>
            
            <!-- Exibição dos marcos em formato JSON -->
            <div class="mt-2">
                <strong>Marcos (JSON):</strong>
                <pre class="border bg-white p-2 mt-1">{{ report_data.marcos_recentes|tojson if report_data is defined and report_data.marcos_recentes is defined else "N/A" }}</pre>
            </div>
        </div>
        
        <div class="report-header text-center">
            <h2>Status Report - Projeto {{ report_data.info_geral.nome | default(project_id, true) }}</h2>
            <p class="text-muted">Gerado em: {{ data_geracao | default('N/A', true) }}</p>
            <!-- <p>Período: [TODO: Definir Período]</p> -->
        </div>

        <!-- Resumo -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card card-kpi">
                    <div class="card-body text-center">
                        <h5 class="card-title">Status Geral</h5>
                        {% set status_color = report_data.status_geral_indicador | default('cinza') %}
                        <span class="status-dot status-{{ status_color }}"></span>
                        <span class="fw-bold text-{{ status_color }}">{{ status_color | capitalize | default('A Definir') }}</span>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card card-kpi">
                    <div class="card-body text-center">
                        <h5 class="card-title">% Concluído</h5>
                        <p class="card-text fs-4 fw-bold">{{ report_data.progresso.percentual_concluido | round(1) }}%</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card card-kpi">
                    <div class="card-body text-center">
                        <h5 class="card-title">Prazo</h5>
                        <p class="card-text">{{ report_data.progresso.data_prevista_termino | default('N/A', true) }}</p>
                        <span class="badge bg-secondary">{{ report_data.progresso.status_prazo | default('A Definir') }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção de Detalhes -->
        <div class="row">
            <div class="col-md-6">
                <h4 class="section-title">Detalhes do Projeto</h4>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>ID:</strong> {{ report_data.info_geral.id | default('N/A') }}</li>
                    <li class="list-group-item"><strong>Nome:</strong> {{ report_data.info_geral.nome | default('N/A') }}</li>
                    <li class="list-group-item"><strong>Status Atual:</strong> {{ report_data.info_geral.status_atual | default('N/A') }}</li>
                    <li class="list-group-item"><strong>Squad:</strong> {{ report_data.info_geral.squad | default('N/A') }}</li>
                    <li class="list-group-item"><strong>Especialista:</strong> {{ report_data.info_geral.especialista | default('N/A') }}</li>
                </ul>

                <h4 class="section-title">Esforço (Horas)</h4>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>Planejado:</strong> {{ report_data.esforco.horas_planejadas | round(1) }}h</li>
                    <li class="list-group-item"><strong>Utilizado:</strong> {{ report_data.esforco.horas_utilizadas | round(1) }}h</li>
                    <li class="list-group-item"><strong>Consumido:</strong> {{ report_data.esforco.percentual_consumido | round(1) }}%</li>
                </ul>
                <!-- TODO: Adicionar gráfico de esforço -->

            </div>
            <div class="col-md-6">
                <h4 class="section-title">Marcos Recentes</h4>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <tbody>
                            {% for marco in report_data.marcos_recentes %}
                                <tr>
                                    <td class="text-start">
                                        {% if marco.atrasado %}<span class="badge bg-danger me-1">!</span>{% endif %}
                                        {{ marco.nome }}
                                    </td>
                                    <td>{{ marco.data_planejada }}</td>
                                    <td>
                                        <span class="badge {% if marco.status == 'COMPLETED' or marco.status == 'CONCLUÍDO' %}bg-success{% elif marco.status == 'IN_PROGRESS' or marco.status == 'EM ANDAMENTO' %}bg-warning text-dark{% elif marco.status == 'DELAYED' or marco.status == 'ATRASADO' %}bg-danger{% else %}bg-secondary{% endif %}">
                                            {% if marco.status == 'COMPLETED' or marco.status == 'CONCLUÍDO' %}Concluído
                                            {% elif marco.status == 'IN_PROGRESS' or marco.status == 'EM ANDAMENTO' %}Em Andamento
                                            {% elif marco.status == 'DELAYED' or marco.status == 'ATRASADO' %}Atrasado
                                            {% else %}Pendente{% endif %}
                                        </span>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <h4 class="section-title">Riscos e Impedimentos</h4>
                 <p class="placeholder">[Placeholder para Riscos e Impedimentos]</p>
                <!-- <ul class="list-group list-group-flush">
                    {% for risco in report_data.riscos_impedimentos %}
                        <li class="list-group-item">{{ risco.descricao }} ({{ risco.status }})</li>
                    {% else %}
                        <li class="list-group-item placeholder">Nenhum risco ou impedimento ativo.</li>
                    {% endfor %}
                </ul> -->

                <h4 class="section-title">Próximos Passos</h4>
                 <p class="placeholder">[Placeholder para Próximos Passos]</p>
                <!-- <ul class="list-group list-group-flush">
                    {% for passo in report_data.proximos_passos %}
                        <li class="list-group-item">{{ passo.descricao }}</li>
                    {% else %}
                        <li class="list-group-item placeholder">Nenhum próximo passo definido.</li>
                    {% endfor %}
                </ul> -->
            </div>
        </div>

        <!-- Seção de cards informativos -->
        <div class="row mt-4">
            <div class="col-md-4 mb-3">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-light">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-calendar-check"></i>
                            Marcos Recentes
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        {% if report_data and report_data.marcos_recentes and report_data.marcos_recentes|length > 0 %}
                            <div class="table-responsive">
                                <table class="table table-sm table-striped mb-0">
                                    <thead>
                                        <tr class="table-light">
                                            <th>Marco</th>
                                            <th>Data</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for marco in report_data.marcos_recentes %}
                                            <tr>
                                                <td class="text-start">
                                                    {% if marco.atrasado %}<span class="badge bg-danger me-1">!</span>{% endif %}
                                                    <strong>{{ marco.nome }}</strong>
                                                </td>
                                                <td>{{ marco.data_planejada }}</td>
                                                <td>
                                                    <span class="badge {% if marco.status == 'COMPLETED' or marco.status == 'CONCLUÍDO' %}bg-success{% elif marco.status == 'IN_PROGRESS' or marco.status == 'EM ANDAMENTO' %}bg-warning text-dark{% elif marco.status == 'DELAYED' or marco.status == 'ATRASADO' %}bg-danger{% else %}bg-secondary{% endif %}">
                                                        {% if marco.status == 'COMPLETED' or marco.status == 'CONCLUÍDO' %}Concluído
                                                        {% elif marco.status == 'IN_PROGRESS' or marco.status == 'EM ANDAMENTO' %}Em Andamento
                                                        {% elif marco.status == 'DELAYED' or marco.status == 'ATRASADO' %}Atrasado
                                                        {% else %}Pendente{% endif %}
                                                    </span>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="text-center p-3 text-muted">
                                Nenhum marco definido para este projeto.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Card de Linha do Tempo (Tarefas) -->
            <div class="col-md-4 mb-3">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-light">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-clock"></i>
                            Linha do Tempo (Tarefas)
                        </h5>
                    </div>
                    <div class="card-body p-3 text-center">
                        <p class="text-muted small">
                            [Uma visualização da linha do tempo das tarefas será adicionada aqui]
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Card de Riscos e Impedimentos -->
            <div class="col-md-4 mb-3">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-light">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-exclamation-triangle"></i>
                            Riscos e Impedimentos
                        </h5>
                    </div>
                    <div class="card-body p-3 text-center">
                        <p class="text-muted small">
                            [Informações sobre riscos e impedimentos serão exibidas aqui]
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- TODO: Adicionar gráficos -->

    {% else %}
         <div class="alert alert-warning" role="alert">
            Não foi possível carregar os dados para o Status Report do projeto ID {{ project_id }}.
        </div>
    {% endif %}

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Script customizado para status report -->
<script>
    // Expõe os dados dos marcos para o script
    window.reportData = {
        marcos_recentes: [
        {% if report_data.marcos_recentes %}
            {% for marco in report_data.marcos_recentes %}
                {
                    nome: "{{ marco.nome }}",
                    data_planejada: "{{ marco.data_planejada }}",
                    status: "{{ marco.status }}",
                    criticidade: "{{ marco.criticidade }}",
                    atrasado: {{ 'true' if marco.atrasado else 'false' }}
                }{% if not loop.last %},{% endif %}
            {% endfor %}
        {% endif %}
        ]
    };
</script>
<script src="/macro/static/js/status_report.js"></script>
<!-- Fim dos scripts -->

</body>
</html> 